<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>无数据加载状态测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>无数据加载状态测试</h1>
        <p class="text-muted">测试系统在没有数据时的各种状态显示</p>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>加载状态测试</h5>
                    </div>
                    <div class="card-body">
                        <div id="loading-test" class="mb-3" style="min-height: 100px;">
                            <!-- 这里会显示加载状态 -->
                        </div>
                        <button class="btn btn-primary" onclick="testLoading()">测试加载状态</button>
                        <button class="btn btn-secondary" onclick="testEmpty()">测试空状态</button>
                        <button class="btn btn-warning" onclick="testError()">测试错误状态</button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>超时测试</h5>
                    </div>
                    <div class="card-body">
                        <div id="timeout-test" class="mb-3" style="min-height: 100px;">
                            <!-- 这里会显示超时测试结果 -->
                        </div>
                        <button class="btn btn-info" onclick="testTimeout()">测试3秒超时</button>
                        <button class="btn btn-success" onclick="testSuccess()">测试成功加载</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>仪表板状态模拟</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="card bg-primary text-white">
                                    <div class="card-body text-center">
                                        <h4 id="total-trades">0</h4>
                                        <p class="mb-0">总交易次数</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-success text-white">
                                    <div class="card-body text-center">
                                        <h4 id="total-profit">0.00%</h4>
                                        <p class="mb-0">总收益率</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-info text-white">
                                    <div class="card-body text-center">
                                        <h4 id="current-holdings">0</h4>
                                        <p class="mb-0">当前持仓</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-warning text-white">
                                    <div class="card-body text-center">
                                        <h4 id="success-rate">0.00%</h4>
                                        <p class="mb-0">成功率</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h6>最近交易</h6>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>日期</th>
                                            <th>股票</th>
                                            <th>类型</th>
                                            <th>价格</th>
                                            <th>数量</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-trades">
                                        <tr>
                                            <td colspan="5" class="text-center text-muted">暂无交易记录</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary mt-3" onclick="simulateDashboard()">模拟仪表板加载</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="static/js/no-data-handler.js"></script>
    
    <script>
        function testLoading() {
            NoDataHandler.showLoadingState('loading-test', '正在加载数据...');
        }
        
        function testEmpty() {
            NoDataHandler.showEmptyState('loading-test', '暂无数据', 'fas fa-inbox');
        }
        
        function testError() {
            NoDataHandler.showErrorState('loading-test', '加载失败');
        }
        
        async function testTimeout() {
            const container = document.getElementById('timeout-test');
            container.innerHTML = '<div class="text-center"><div class="spinner-border" role="status"></div> 测试超时中...</div>';
            
            try {
                // 模拟一个5秒的请求，但3秒超时
                await NoDataHandler.withTimeout(
                    new Promise(resolve => setTimeout(resolve, 5000)),
                    3000,
                    '请求超时'
                );
                container.innerHTML = '<div class="alert alert-success">请求成功</div>';
            } catch (error) {
                container.innerHTML = `<div class="alert alert-warning">${error.message}</div>`;
            }
        }
        
        async function testSuccess() {
            const container = document.getElementById('timeout-test');
            container.innerHTML = '<div class="text-center"><div class="spinner-border" role="status"></div> 加载中...</div>';
            
            try {
                // 模拟一个1秒的成功请求
                await NoDataHandler.withTimeout(
                    new Promise(resolve => setTimeout(resolve, 1000)),
                    3000
                );
                container.innerHTML = '<div class="alert alert-success">加载成功！</div>';
            } catch (error) {
                container.innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
            }
        }
        
        function simulateDashboard() {
            // 模拟仪表板数据加载过程
            console.log('模拟仪表板加载...');
            
            // 先显示默认数据
            updateStatsCards({
                total_trades: 0,
                total_return_rate: 0,
                current_holdings_count: 0,
                success_rate: 0
            });
            
            // 模拟异步加载数据
            setTimeout(() => {
                updateStatsCards({
                    total_trades: 15,
                    total_return_rate: 8.5,
                    current_holdings_count: 3,
                    success_rate: 73.3
                });
                
                updateRecentTrades([
                    {
                        trade_date: '2025-01-15',
                        stock_name: '平安银行',
                        stock_code: '000001',
                        trade_type: 'buy',
                        price: 12.50,
                        quantity: 1000
                    },
                    {
                        trade_date: '2025-01-14',
                        stock_name: '招商银行',
                        stock_code: '600036',
                        trade_type: 'sell',
                        price: 37.20,
                        quantity: 500
                    }
                ]);
            }, 1000);
        }
        
        function updateStatsCards(data) {
            document.getElementById('total-trades').textContent = data.total_trades || 0;
            document.getElementById('total-profit').textContent = (data.total_return_rate || 0).toFixed(2) + '%';
            document.getElementById('current-holdings').textContent = data.current_holdings_count || 0;
            document.getElementById('success-rate').textContent = (data.success_rate || 0).toFixed(2) + '%';
        }
        
        function updateRecentTrades(trades) {
            const tbody = document.getElementById('recent-trades');
            if (!trades || trades.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">暂无交易记录</td></tr>';
                return;
            }
            
            tbody.innerHTML = trades.map(trade => `
                <tr>
                    <td>${trade.trade_date}</td>
                    <td>
                        <span class="fw-bold">${trade.stock_name}</span>
                        <small class="text-muted d-block">${trade.stock_code}</small>
                    </td>
                    <td>
                        <span class="badge ${trade.trade_type === 'buy' ? 'bg-success' : 'bg-danger'}">
                            ${trade.trade_type === 'buy' ? '买入' : '卖出'}
                        </span>
                    </td>
                    <td>¥${trade.price}</td>
                    <td>${trade.quantity}</td>
                </tr>
            `).join('');
        }
        
        // 页面加载时显示初始状态
        document.addEventListener('DOMContentLoaded', () => {
            testEmpty();
            document.getElementById('timeout-test').innerHTML = '<div class="text-muted text-center">点击按钮测试超时功能</div>';
        });
    </script>
</body>
</html>