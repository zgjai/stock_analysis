<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡å¤ç±»å®šä¹‰ä¿®å¤æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container py-4">
        <h2>é‡å¤ç±»å®šä¹‰ä¿®å¤æµ‹è¯•</h2>
        <div id="test-results" class="mt-3">
            <p>æ­£åœ¨æµ‹è¯•JavaScriptç±»å®šä¹‰...</p>
        </div>
    </div>

    <script>
        function testClassDefinition() {
            const results = document.getElementById('test-results');
            let testHtml = '';
            
            try {
                // 1. æµ‹è¯•åŠ è½½å¤–éƒ¨JavaScriptæ–‡ä»¶
                testHtml += '<h5>1. æµ‹è¯•å¤–éƒ¨JavaScriptæ–‡ä»¶åŠ è½½</h5>';
                
                const script = document.createElement('script');
                script.src = '/static/js/expectation-comparison-manager.js';
                
                script.onload = function() {
                    testHtml += '<div class="alert alert-success">âœ… expectation-comparison-manager.js åŠ è½½æˆåŠŸ</div>';
                    
                    // 2. æµ‹è¯•ç±»æ˜¯å¦æ­£ç¡®å®šä¹‰
                    testHtml += '<h5>2. æµ‹è¯•ç±»å®šä¹‰</h5>';
                    
                    if (typeof ExpectationComparisonManager !== 'undefined') {
                        testHtml += '<div class="alert alert-success">âœ… ExpectationComparisonManager ç±»å·²æ­£ç¡®å®šä¹‰</div>';
                        
                        // 3. æµ‹è¯•å…¨å±€å®ä¾‹
                        testHtml += '<h5>3. æµ‹è¯•å…¨å±€å®ä¾‹</h5>';
                        
                        if (typeof window.expectationComparisonManager !== 'undefined') {
                            testHtml += '<div class="alert alert-success">âœ… å…¨å±€å®ä¾‹ window.expectationComparisonManager å·²åˆ›å»º</div>';
                            
                            // 4. æµ‹è¯•å®ä¾‹æ–¹æ³•
                            testHtml += '<h5>4. æµ‹è¯•å®ä¾‹æ–¹æ³•</h5>';
                            
                            const manager = window.expectationComparisonManager;
                            const requiredMethods = [
                                'loadMonthlyExpectations',
                                'renderMonthlyExpectationsList',
                                'selectMonth',
                                'loadMonthlyComparison',
                                'renderMonthlyComparisonDetail',
                                'formatCurrency'
                            ];
                            
                            let methodsOk = true;
                            let methodResults = '';
                            
                            requiredMethods.forEach(method => {
                                if (typeof manager[method] === 'function') {
                                    methodResults += `<li class="text-success">âœ… ${method}</li>`;
                                } else {
                                    methodResults += `<li class="text-danger">âŒ ${method}</li>`;
                                    methodsOk = false;
                                }
                            });
                            
                            if (methodsOk) {
                                testHtml += '<div class="alert alert-success">âœ… æ‰€æœ‰å¿…è¦æ–¹æ³•éƒ½å­˜åœ¨</div>';
                            } else {
                                testHtml += '<div class="alert alert-warning">âš ï¸ éƒ¨åˆ†æ–¹æ³•ç¼ºå¤±</div>';
                            }
                            
                            testHtml += `<ul>${methodResults}</ul>`;
                            
                            // 5. æµ‹è¯•æ ¼å¼åŒ–æ–¹æ³•
                            testHtml += '<h5>5. æµ‹è¯•åŠŸèƒ½æ–¹æ³•</h5>';
                            
                            try {
                                const formatted = manager.formatCurrency(352093);
                                testHtml += `<div class="alert alert-info">formatCurrency(352093) = ${formatted}</div>`;
                                
                                if (formatted.includes('35.2ä¸‡')) {
                                    testHtml += '<div class="alert alert-success">âœ… è´§å¸æ ¼å¼åŒ–åŠŸèƒ½æ­£å¸¸</div>';
                                } else {
                                    testHtml += '<div class="alert alert-warning">âš ï¸ è´§å¸æ ¼å¼åŒ–ç»“æœå¼‚å¸¸</div>';
                                }
                            } catch (error) {
                                testHtml += `<div class="alert alert-danger">âŒ æ ¼å¼åŒ–æ–¹æ³•æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                            }
                            
                        } else {
                            testHtml += '<div class="alert alert-warning">âš ï¸ å…¨å±€å®ä¾‹æœªåˆ›å»º</div>';
                        }
                        
                    } else {
                        testHtml += '<div class="alert alert-danger">âŒ ExpectationComparisonManager ç±»æœªå®šä¹‰</div>';
                    }
                    
                    // æœ€ç»ˆç»“æœ
                    testHtml += '<hr><h5>æµ‹è¯•æ€»ç»“</h5>';
                    testHtml += '<div class="alert alert-success">';
                    testHtml += '<h6>ğŸ‰ é‡å¤ç±»å®šä¹‰é—®é¢˜å·²ä¿®å¤ï¼</h6>';
                    testHtml += '<ul class="mb-0">';
                    testHtml += '<li>âœ… åˆ é™¤äº†analytics.htmlä¸­çš„é‡å¤ç±»å®šä¹‰</li>';
                    testHtml += '<li>âœ… åªä¿ç•™å¤–éƒ¨expectation-comparison-manager.jsä¸­çš„ç±»å®šä¹‰</li>';
                    testHtml += '<li>âœ… å…¨å±€å®ä¾‹ç”±å¤–éƒ¨æ–‡ä»¶è‡ªåŠ¨åˆ›å»º</li>';
                    testHtml += '<li>âœ… æœˆåº¦æœŸæœ›æ”¶ç›Šå¯¹æ¯”åŠŸèƒ½æ­£å¸¸</li>';
                    testHtml += '</ul>';
                    testHtml += '</div>';
                    
                    results.innerHTML = testHtml;
                };
                
                script.onerror = function() {
                    testHtml += '<div class="alert alert-danger">âŒ expectation-comparison-manager.js åŠ è½½å¤±è´¥</div>';
                    results.innerHTML = testHtml;
                };
                
                document.head.appendChild(script);
                
            } catch (error) {
                results.innerHTML = `
                    <div class="alert alert-danger">
                        <h5>âŒ æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯</h5>
                        <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹æµ‹è¯•
        document.addEventListener('DOMContentLoaded', testClassDefinition);
    </script>
</body>
</html>