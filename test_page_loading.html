<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡µé¢åŠ è½½æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>é¡µé¢åŠ è½½æµ‹è¯•</h2>
        
        <div class="alert alert-info">
            <h5>æµ‹è¯•ç›®æ ‡ï¼š</h5>
            <ul>
                <li>éªŒè¯JavaScriptè¯­æ³•æ˜¯å¦æ­£ç¡®</li>
                <li>éªŒè¯TradingRecordsManagerç±»æ˜¯å¦èƒ½æ­£å¸¸åˆå§‹åŒ–</li>
                <li>éªŒè¯å…³é”®æ–¹æ³•æ˜¯å¦å­˜åœ¨</li>
            </ul>
        </div>

        <div class="card">
            <div class="card-header">
                <h5>æµ‹è¯•ç»“æœ</h5>
            </div>
            <div class="card-body">
                <div id="test-results">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">æµ‹è¯•ä¸­...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/utils.js"></script>
    <script src="/static/js/api.js"></script>
    <script>
        // æ¨¡æ‹Ÿäº¤æ˜“è®°å½•é¡µé¢çš„å…³é”®éƒ¨åˆ†
        function testPageLoading() {
            const results = [];
            
            try {
                // æµ‹è¯•1: æ£€æŸ¥å¿…è¦çš„å·¥å…·ç±»æ˜¯å¦å­˜åœ¨
                if (typeof FormUtils !== 'undefined') {
                    results.push('âœ… FormUtils å·¥å…·ç±»å­˜åœ¨');
                } else {
                    results.push('âŒ FormUtils å·¥å…·ç±»ç¼ºå¤±');
                }
                
                if (typeof UXUtils !== 'undefined') {
                    results.push('âœ… UXUtils å·¥å…·ç±»å­˜åœ¨');
                } else {
                    results.push('âŒ UXUtils å·¥å…·ç±»ç¼ºå¤±');
                }
                
                // æµ‹è¯•2: æ¨¡æ‹ŸTradingRecordsManagerç±»çš„å…³é”®éƒ¨åˆ†
                class TestTradingRecordsManager {
                    constructor() {
                        this.currentPage = 1;
                        this.buyReasons = ['å°‘å¦‡B1æˆ˜æ³•', 'å°‘å¦‡SB1æˆ˜æ³•'];
                        this.sellReasons = ['éƒ¨åˆ†æ­¢ç›ˆ', 'æ­¢æŸ'];
                    }
                    
                    // æ¨¡æ‹ŸhandleTradeFormSubmitæ–¹æ³•çš„å…³é”®é€»è¾‘
                    testHandleTradeFormSubmit() {
                        const formData = {
                            stock_code: '000776',
                            stock_name: 'å¹¿å‘è¯åˆ¸',
                            price: 19.45,
                            quantity: 31100
                        };
                        
                        // æ¨¡æ‹Ÿæ­¢æŸä»·æ ¼å¤„ç†é€»è¾‘
                        const stopLossPriceElement = document.createElement('input');
                        stopLossPriceElement.value = '18.50';
                        
                        if (stopLossPriceElement && stopLossPriceElement.value && stopLossPriceElement.value.trim() !== '') {
                            const stopLossPrice = parseFloat(stopLossPriceElement.value);
                            if (!isNaN(stopLossPrice) && stopLossPrice > 0) {
                                formData.stop_loss_price = stopLossPrice;
                                return true;
                            }
                        }
                        return false;
                    }
                    
                    triggerFormValidation() {
                        return true;
                    }
                }
                
                // æµ‹è¯•3: å®ä¾‹åŒ–æµ‹è¯•ç±»
                const testManager = new TestTradingRecordsManager();
                results.push('âœ… TradingRecordsManager ç±»ç»“æ„æ­£å¸¸');
                
                // æµ‹è¯•4: æµ‹è¯•å…³é”®æ–¹æ³•
                if (typeof testManager.triggerFormValidation === 'function') {
                    results.push('âœ… triggerFormValidation æ–¹æ³•å­˜åœ¨');
                } else {
                    results.push('âŒ triggerFormValidation æ–¹æ³•ç¼ºå¤±');
                }
                
                // æµ‹è¯•5: æµ‹è¯•æ­¢æŸä»·æ ¼å¤„ç†é€»è¾‘
                if (testManager.testHandleTradeFormSubmit()) {
                    results.push('âœ… æ­¢æŸä»·æ ¼å¤„ç†é€»è¾‘æ­£å¸¸');
                } else {
                    results.push('âŒ æ­¢æŸä»·æ ¼å¤„ç†é€»è¾‘æœ‰é—®é¢˜');
                }
                
            } catch (error) {
                results.push(`âŒ JavaScripté”™è¯¯: ${error.message}`);
                console.error('æµ‹è¯•é”™è¯¯:', error);
            }
            
            // æ˜¾ç¤ºç»“æœ
            const resultsDiv = document.getElementById('test-results');
            let resultHtml = '<h6>æµ‹è¯•ç»“æœï¼š</h6>';
            
            results.forEach(result => {
                const status = result.includes('âŒ') ? 'text-danger' : 'text-success';
                resultHtml += `<div class="${status}">${result}</div>`;
            });
            
            const successCount = results.filter(r => r.includes('âœ…')).length;
            const totalCount = results.length;
            
            resultHtml += `<hr><div class="fw-bold">æˆåŠŸç‡: ${successCount}/${totalCount} (${(successCount/totalCount*100).toFixed(1)}%)</div>`;
            
            if (successCount === totalCount) {
                resultHtml += '<div class="text-success mt-2">ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼é¡µé¢åº”è¯¥èƒ½æ­£å¸¸åŠ è½½ã€‚</div>';
            } else {
                resultHtml += '<div class="text-danger mt-2">âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œå¯èƒ½å½±å“é¡µé¢åŠŸèƒ½ã€‚</div>';
            }
            
            resultsDiv.innerHTML = resultHtml;
        }
        
        // é¡µé¢åŠ è½½åè¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(testPageLoading, 500);
        });
    </script>
</body>
</html>