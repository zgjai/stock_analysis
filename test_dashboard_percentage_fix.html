<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»ªè¡¨æ¿ç™¾åˆ†æ¯”æ˜¾ç¤ºä¿®å¤æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>ä»ªè¡¨æ¿ç™¾åˆ†æ¯”æ˜¾ç¤ºä¿®å¤æµ‹è¯•</h2>
        
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>ä¿®å¤å‰çš„é—®é¢˜</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>é—®é¢˜æè¿°ï¼š</strong></p>
                        <ul>
                            <li>æ€»æ”¶ç›Šç‡æ˜¾ç¤ºä¸º 0.02%ï¼ˆåº”è¯¥æ˜¯ 2.00%ï¼‰</li>
                            <li>æˆåŠŸç‡æ˜¾ç¤ºä¸º 0.41%ï¼ˆåº”è¯¥æ˜¯ 41.0%ï¼‰</li>
                        </ul>
                        
                        <p><strong>åŸå› åˆ†æï¼š</strong></p>
                        <ul>
                            <li>åç«¯è¿”å›å°æ•°å½¢å¼ï¼štotal_return_rate = 0.02ï¼ˆè¡¨ç¤º2%ï¼‰</li>
                            <li>å‰ç«¯é”™è¯¯åœ°å†æ¬¡é™¤ä»¥100ï¼š0.02 / 100 = 0.0002</li>
                            <li>Formatters.percentageå†ä¹˜ä»¥100ï¼š0.0002 * 100 = 0.02%</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>ä¿®å¤åçš„æ•ˆæœ</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>ä¿®å¤æ–¹æ¡ˆï¼š</strong></p>
                        <ul>
                            <li>ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„å°æ•°å€¼</li>
                            <li>è®©Formatters.percentageæ­£ç¡®å¤„ç†è½¬æ¢</li>
                        </ul>
                        
                        <p><strong>é¢„æœŸç»“æœï¼š</strong></p>
                        <ul>
                            <li>æ€»æ”¶ç›Šç‡ï¼š2.00%</li>
                            <li>æˆåŠŸç‡ï¼š41.0%</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>æµ‹è¯•æ•°æ®æ¨¡æ‹Ÿ</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="card stats-card">
                                    <div class="card-body text-center">
                                        <h4 id="total-profit" class="stats-value">--</h4>
                                        <p class="mb-0">æ€»æ”¶ç›Šç‡</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card stats-card">
                                    <div class="card-body text-center">
                                        <h4 id="success-rate" class="stats-value">--</h4>
                                        <p class="mb-0">æˆåŠŸç‡</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card stats-card">
                                    <div class="card-body text-center">
                                        <h4 id="test-old-logic" class="stats-value">--</h4>
                                        <p class="mb-0">æ—§é€»è¾‘ç»“æœ</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card stats-card">
                                    <div class="card-body text-center">
                                        <h4 id="test-new-logic" class="stats-value">--</h4>
                                        <p class="mb-0">æ–°é€»è¾‘ç»“æœ</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-primary" onclick="testPercentageLogic()">æµ‹è¯•ç™¾åˆ†æ¯”é€»è¾‘</button>
                            <button class="btn btn-success" onclick="simulateApiData()">æ¨¡æ‹ŸAPIæ•°æ®</button>
                            <button class="btn btn-info" onclick="testEdgeCases()">æµ‹è¯•è¾¹ç•Œæƒ…å†µ</button>
                        </div>
                        
                        <div id="test-results" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/utils.js"></script>
    <script>
        // æ¨¡æ‹Ÿåç«¯APIè¿”å›çš„æ•°æ®
        const mockApiData = {
            total_return_rate: 0.02,    // 2%
            success_rate: 0.41,         // 41%
            realized_profit: 20000,
            current_holdings_profit: 5000,
            total_investment: 1000000
        };

        function testPercentageLogic() {
            const results = [];
            
            // æµ‹è¯•æ€»æ”¶ç›Šç‡
            const totalReturnRate = mockApiData.total_return_rate;
            
            // æ—§é€»è¾‘ï¼ˆé”™è¯¯çš„ï¼‰
            const oldLogicRate = (totalReturnRate / 100) * 100; // 0.02 / 100 * 100 = 0.02
            
            // æ–°é€»è¾‘ï¼ˆæ­£ç¡®çš„ï¼‰
            const newLogicRate = totalReturnRate * 100; // 0.02 * 100 = 2.0
            
            results.push(`<h6>æ€»æ”¶ç›Šç‡æµ‹è¯•ï¼š</h6>`);
            results.push(`åç«¯è¿”å›å€¼: ${totalReturnRate}`);
            results.push(`æ—§é€»è¾‘ç»“æœ: ${oldLogicRate}%`);
            results.push(`æ–°é€»è¾‘ç»“æœ: ${newLogicRate}%`);
            results.push(`<br>`);
            
            // æµ‹è¯•æˆåŠŸç‡
            const successRate = mockApiData.success_rate;
            const oldLogicSuccess = (successRate / 100) * 100;
            const newLogicSuccess = successRate * 100;
            
            results.push(`<h6>æˆåŠŸç‡æµ‹è¯•ï¼š</h6>`);
            results.push(`åç«¯è¿”å›å€¼: ${successRate}`);
            results.push(`æ—§é€»è¾‘ç»“æœ: ${oldLogicSuccess}%`);
            results.push(`æ–°é€»è¾‘ç»“æœ: ${newLogicSuccess}%`);
            
            document.getElementById('test-results').innerHTML = results.join('<br>');
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('test-old-logic').textContent = oldLogicRate + '%';
            document.getElementById('test-new-logic').textContent = newLogicRate + '%';
        }

        function simulateApiData() {
            // ä½¿ç”¨ä¿®å¤åçš„é€»è¾‘æ›´æ–°æ˜¾ç¤º
            updateStatsCards(mockApiData);
            
            addResult('âœ… æ¨¡æ‹ŸAPIæ•°æ®åŠ è½½å®Œæˆ');
            addResult(`æ€»æ”¶ç›Šç‡: ${(mockApiData.total_return_rate * 100).toFixed(2)}%`);
            addResult(`æˆåŠŸç‡: ${(mockApiData.success_rate * 100).toFixed(1)}%`);
        }

        function testEdgeCases() {
            const edgeCases = [
                { name: 'é›¶å€¼', total_return_rate: 0, success_rate: 0 },
                { name: 'è´Ÿå€¼', total_return_rate: -0.05, success_rate: 0.2 },
                { name: 'å¤§å€¼', total_return_rate: 1.5, success_rate: 0.95 },
                { name: 'nullå€¼', total_return_rate: null, success_rate: null },
                { name: 'undefinedå€¼', total_return_rate: undefined, success_rate: undefined }
            ];
            
            const results = ['<h6>è¾¹ç•Œæƒ…å†µæµ‹è¯•ï¼š</h6>'];
            
            edgeCases.forEach(testCase => {
                const returnRate = Formatters.percentage(testCase.total_return_rate);
                const successRate = Formatters.percentage(testCase.success_rate);
                
                results.push(`${testCase.name}: æ”¶ç›Šç‡=${returnRate}, æˆåŠŸç‡=${successRate}`);
            });
            
            document.getElementById('test-results').innerHTML = results.join('<br>');
        }

        function updateStatsCards(data) {
            // æ›´æ–°æ€»æ”¶ç›Šç‡ï¼ˆä¿®å¤åçš„é€»è¾‘ï¼‰
            const totalProfitElement = document.getElementById('total-profit');
            if (totalProfitElement) {
                const profit = data.total_return_rate || 0; // ç›´æ¥ä½¿ç”¨ï¼Œä¸å†é™¤ä»¥100
                totalProfitElement.textContent = Formatters.percentage(profit);
                
                // è®¾ç½®é¢œè‰²
                if (profit > 0) {
                    totalProfitElement.style.color = '#dc3545'; // çº¢è‰²è¡¨ç¤ºç›ˆåˆ©
                } else if (profit < 0) {
                    totalProfitElement.style.color = '#28a745'; // ç»¿è‰²è¡¨ç¤ºäºæŸ
                } else {
                    totalProfitElement.style.color = '#6c757d'; // ç°è‰²è¡¨ç¤ºæŒå¹³
                }
            }

            // æ›´æ–°æˆåŠŸç‡ï¼ˆä¿®å¤åçš„é€»è¾‘ï¼‰
            const successRateElement = document.getElementById('success-rate');
            if (successRateElement) {
                const rate = data.success_rate || 0; // ç›´æ¥ä½¿ç”¨ï¼Œä¸å†é™¤ä»¥100
                successRateElement.textContent = Formatters.percentage(rate);
            }
        }

        function addResult(message) {
            const resultsDiv = document.getElementById('test-results');
            const currentContent = resultsDiv.innerHTML;
            resultsDiv.innerHTML = currentContent + '<br>' + message;
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåˆå§‹çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            addResult('ğŸ“Š ä»ªè¡¨æ¿ç™¾åˆ†æ¯”æ˜¾ç¤ºä¿®å¤æµ‹è¯•å·²å‡†å¤‡å°±ç»ª');
            addResult('ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...');
        });
    </script>
</body>
</html>