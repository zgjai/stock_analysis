# 历史交易记录功能部署检查清单

## 部署前检查 (Pre-deployment)

### 环境准备
- [ ] Python 3.8+ 已安装
- [ ] pip 已安装并更新到最新版本
- [ ] 虚拟环境已创建并激活
- [ ] 所有依赖包已安装 (`pip install -r requirements.txt`)
- [ ] 系统依赖已安装 (nginx, supervisor等)

### 配置文件
- [ ] `.env` 文件已创建并配置
- [ ] `SECRET_KEY` 已设置为强密码
- [ ] `DATABASE_URL` 已正确配置
- [ ] 文件上传路径已配置
- [ ] 日志配置已设置

### 安全配置
- [ ] 生产环境密钥已更换
- [ ] 数据库连接使用安全凭据
- [ ] 文件上传限制已配置
- [ ] CSRF保护已启用

## 存储配置检查

### 目录结构
- [ ] `data/` 目录已创建
- [ ] `logs/` 目录已创建
- [ ] `backups/` 目录已创建
- [ ] `uploads/` 目录已创建
- [ ] `uploads/reviews/` 目录已创建
- [ ] `uploads/reviews/images/` 目录已创建

### 权限设置
- [ ] 上传目录具有写权限 (755)
- [ ] 日志目录具有写权限 (755)
- [ ] 数据目录具有写权限 (755)
- [ ] 备份目录具有写权限 (755)

### 配置文件生成
- [ ] Nginx配置文件已生成
- [ ] systemd服务文件已生成
- [ ] 安全配置文件已生成

## 数据库迁移检查

### 迁移准备
- [ ] 数据库连接测试通过
- [ ] 现有数据已备份
- [ ] 迁移脚本干运行测试通过

### 迁移执行
- [ ] `historical_trades` 表已创建
- [ ] `trade_reviews` 表已创建
- [ ] `review_images` 表已创建
- [ ] 所有索引已创建
- [ ] 外键约束已设置
- [ ] 数据完整性约束已设置

### 迁移验证
- [ ] 表结构符合设计要求
- [ ] 索引创建成功
- [ ] 约束条件正常工作
- [ ] 迁移记录已保存

## Web服务器配置检查

### Nginx配置
- [ ] 配置文件语法正确 (`nginx -t`)
- [ ] 静态文件路径配置正确
- [ ] 上传文件路径配置正确
- [ ] 代理配置正确
- [ ] 安全头配置正确
- [ ] 文件大小限制配置正确

### 服务配置
- [ ] systemd服务文件已安装
- [ ] 服务已启用 (`systemctl enable`)
- [ ] 服务可以正常启动
- [ ] 服务自动重启配置正确
- [ ] 工作目录配置正确
- [ ] 环境变量配置正确

## 应用测试检查

### 基础功能测试
- [ ] 应用可以正常启动
- [ ] 数据库连接正常
- [ ] 静态文件可以访问
- [ ] API端点响应正常

### 历史交易功能测试
- [ ] 历史交易页面可以访问
- [ ] 历史交易数据可以正常显示
- [ ] 分页功能正常工作
- [ ] 筛选功能正常工作

### 复盘功能测试
- [ ] 复盘编辑器可以正常打开
- [ ] 复盘内容可以保存
- [ ] 图片上传功能正常
- [ ] 复盘内容可以正常显示

### 安全测试
- [ ] 文件上传类型限制生效
- [ ] 文件大小限制生效
- [ ] CSRF保护正常工作
- [ ] 安全头正确设置

## 备份系统检查

### 备份配置
- [ ] 备份脚本可以正常运行
- [ ] 数据库备份功能正常
- [ ] 文件备份功能正常
- [ ] 完整备份功能正常

### 恢复测试
- [ ] 数据库恢复功能正常
- [ ] 文件恢复功能正常
- [ ] 完整恢复功能正常
- [ ] 备份验证功能正常

### 定时任务
- [ ] 定时备份任务已配置
- [ ] 定时清理任务已配置
- [ ] cron任务可以正常执行

## 监控和日志检查

### 日志配置
- [ ] 应用日志正常输出
- [ ] 日志轮转配置正确
- [ ] 错误日志可以正常记录
- [ ] 访问日志可以正常记录

### 监控设置
- [ ] 服务状态监控正常
- [ ] 资源使用监控正常
- [ ] 错误告警配置正确

## 性能优化检查

### 数据库优化
- [ ] 数据库索引已优化
- [ ] 查询性能符合要求
- [ ] 连接池配置合理

### 文件服务优化
- [ ] 静态文件缓存配置正确
- [ ] 图片文件访问优化
- [ ] 上传文件处理优化

### 应用性能
- [ ] 页面加载时间符合要求
- [ ] API响应时间符合要求
- [ ] 内存使用合理

## 部署后验证

### 功能验证
- [ ] 所有页面可以正常访问
- [ ] 所有功能可以正常使用
- [ ] 数据可以正常保存和读取
- [ ] 文件上传和下载正常

### 性能验证
- [ ] 页面响应时间 < 3秒
- [ ] API响应时间 < 1秒
- [ ] 文件上传速度合理
- [ ] 系统资源使用正常

### 安全验证
- [ ] 安全扫描通过
- [ ] 权限控制正常
- [ ] 数据传输安全
- [ ] 文件访问安全

## 文档和培训

### 文档准备
- [ ] 部署文档已完成
- [ ] 用户手册已准备
- [ ] API文档已更新
- [ ] 故障排除指南已准备

### 团队培训
- [ ] 开发团队已培训
- [ ] 运维团队已培训
- [ ] 用户培训已完成
- [ ] 支持流程已建立

## 上线准备

### 最终检查
- [ ] 所有测试用例通过
- [ ] 性能测试通过
- [ ] 安全测试通过
- [ ] 备份恢复测试通过

### 上线计划
- [ ] 上线时间已确定
- [ ] 回滚计划已准备
- [ ] 监控告警已配置
- [ ] 支持团队已就位

### 上线后监控
- [ ] 实时监控已启动
- [ ] 错误日志监控正常
- [ ] 性能指标监控正常
- [ ] 用户反馈收集正常

---

## 签署确认

### 开发团队确认
- [ ] 功能开发完成
- [ ] 代码审查通过
- [ ] 单元测试通过
- [ ] 集成测试通过

签署人: _________________ 日期: _________________

### 测试团队确认
- [ ] 功能测试通过
- [ ] 性能测试通过
- [ ] 安全测试通过
- [ ] 兼容性测试通过

签署人: _________________ 日期: _________________

### 运维团队确认
- [ ] 部署环境就绪
- [ ] 监控系统就绪
- [ ] 备份系统就绪
- [ ] 应急预案就绪

签署人: _________________ 日期: _________________

### 项目经理确认
- [ ] 所有检查项目完成
- [ ] 风险评估完成
- [ ] 上线计划确认
- [ ] 授权正式上线

签署人: _________________ 日期: _________________