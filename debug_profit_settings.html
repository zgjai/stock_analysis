<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>调试止盈止损设置</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>调试止盈止损设置显示问题</h2>
        
        <div class="card">
            <div class="card-body">
                <form id="test-form" novalidate>
                    <div class="mb-3">
                        <label for="trade-type" class="form-label">交易类型</label>
                        <select class="form-select" id="trade-type" name="trade_type">
                            <option value="">请选择交易类型</option>
                            <option value="buy">买入</option>
                            <option value="sell">卖出</option>
                        </select>
                    </div>

                    <!-- 买入时的止损止盈设置 -->
                    <div id="buy-settings" style="display: none;">
                        <div class="alert alert-info">
                            <strong>止盈止损设置区域</strong> - 这个区域应该在选择"买入"时显示
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0">止损止盈设置</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="use-batch-profit-taking">
                                <label class="form-check-label" for="use-batch-profit-taking">
                                    分批止盈
                                </label>
                            </div>
                        </div>

                        <!-- 止损设置 -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="stop-loss-price" class="form-label">止损价格</label>
                                <div class="input-group">
                                    <span class="input-group-text">¥</span>
                                    <input type="number" class="form-control" id="stop-loss-price" step="0.01" placeholder="0.00">
                                </div>
                            </div>
                        </div>

                        <!-- 单一止盈设置 -->
                        <div id="single-profit-settings">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="take-profit-ratio" class="form-label">止盈比例</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="take-profit-ratio" step="0.01" placeholder="0.20">
                                        <span class="input-group-text">%</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="sell-ratio" class="form-label">卖出比例</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="sell-ratio" step="0.01" placeholder="0.50">
                                        <span class="input-group-text">%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 分批止盈设置 -->
                        <div id="batch-profit-settings" style="display: none;">
                            <div class="alert alert-success">
                                分批止盈设置区域 - 这个区域应该在开启分批止盈开关时显示
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="mt-3">
            <h5>调试信息</h5>
            <div id="debug-info" class="alert alert-secondary">
                <div>当前交易类型: <span id="current-trade-type">未选择</span></div>
                <div>买入设置显示状态: <span id="buy-settings-display">隐藏</span></div>
                <div>分批止盈开关状态: <span id="batch-switch-status">关闭</span></div>
            </div>
        </div>
    </div>

    <script>
        // 简化的调试脚本
        document.addEventListener('DOMContentLoaded', function() {
            const tradeTypeSelect = document.getElementById('trade-type');
            const buySettings = document.getElementById('buy-settings');
            const batchSwitch = document.getElementById('use-batch-profit-taking');
            const singleProfitSettings = document.getElementById('single-profit-settings');
            const batchProfitSettings = document.getElementById('batch-profit-settings');

            // 调试信息元素
            const currentTradeTypeSpan = document.getElementById('current-trade-type');
            const buySettingsDisplaySpan = document.getElementById('buy-settings-display');
            const batchSwitchStatusSpan = document.getElementById('batch-switch-status');

            function updateDebugInfo() {
                currentTradeTypeSpan.textContent = tradeTypeSelect.value || '未选择';
                buySettingsDisplaySpan.textContent = buySettings.style.display === 'none' ? '隐藏' : '显示';
                batchSwitchStatusSpan.textContent = batchSwitch.checked ? '开启' : '关闭';
            }

            function toggleBuySettings(show) {
                console.log('toggleBuySettings called with:', show);
                buySettings.style.display = show ? 'block' : 'none';
                updateDebugInfo();
            }

            function toggleProfitTakingMode(useBatchMode) {
                console.log('toggleProfitTakingMode called with:', useBatchMode);
                if (useBatchMode) {
                    singleProfitSettings.style.display = 'none';
                    batchProfitSettings.style.display = 'block';
                } else {
                    singleProfitSettings.style.display = 'block';
                    batchProfitSettings.style.display = 'none';
                }
                updateDebugInfo();
            }

            // 交易类型变化事件
            tradeTypeSelect.addEventListener('change', function(e) {
                console.log('Trade type changed to:', e.target.value);
                const isBuy = e.target.value === 'buy';
                toggleBuySettings(isBuy);
            });

            // 分批止盈开关事件
            batchSwitch.addEventListener('change', function(e) {
                console.log('Batch profit taking switch changed to:', e.target.checked);
                toggleProfitTakingMode(e.target.checked);
            });

            // 初始化调试信息
            updateDebugInfo();
        });
    </script>
</body>
</html>