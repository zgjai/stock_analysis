<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡¨å•éªŒè¯ä¿®å¤æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="test-container">
        <h2>è¡¨å•éªŒè¯ä¿®å¤æµ‹è¯•</h2>
        <p>æµ‹è¯•äº¤æ˜“æ—¥æœŸå’Œæ•°é‡å­—æ®µçš„éªŒè¯é€»è¾‘æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>

        <div class="card">
            <div class="card-header">
                <h5>æµ‹è¯•è¡¨å•</h5>
            </div>
            <div class="card-body">
                <form id="test-form" novalidate>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="trade-date" class="form-label">äº¤æ˜“æ—¥æœŸ *</label>
                            <input type="datetime-local" class="form-control" id="trade-date" name="trade_date" required>
                            <div class="invalid-feedback"></div>
                        </div>
                        <div class="col-md-6">
                            <label for="quantity" class="form-label">æ•°é‡ *</label>
                            <input type="number" class="form-control" id="quantity" name="quantity" required>
                            <div class="invalid-feedback"></div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <label for="price" class="form-label">ä»·æ ¼ *</label>
                            <input type="number" step="0.01" class="form-control" id="price" name="price" required>
                            <div class="invalid-feedback"></div>
                        </div>
                        <div class="col-md-6">
                            <label for="stock-code" class="form-label">è‚¡ç¥¨ä»£ç  *</label>
                            <input type="text" class="form-control" id="stock-code" name="stock_code" required>
                            <div class="invalid-feedback"></div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button type="button" class="btn btn-primary" onclick="testValidation()">æµ‹è¯•éªŒè¯</button>
                        <button type="button" class="btn btn-secondary" onclick="fillTestData()">å¡«å……æµ‹è¯•æ•°æ®</button>
                        <button type="button" class="btn btn-warning" onclick="clearForm()">æ¸…ç©ºè¡¨å•</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5>æµ‹è¯•ç»“æœ</h5>
            </div>
            <div class="card-body">
                <div id="test-results"></div>
            </div>
        </div>
    </div>

    <script src="static/js/simple-form-validator.js"></script>
    <script>
        let validator;

        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–éªŒè¯å™¨
            validator = new SimpleFormValidator('test-form');
            
            // è®¾ç½®é»˜è®¤äº¤æ˜“æ—¥æœŸ
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000)
                .toISOString().slice(0, 16);
            document.getElementById('trade-date').value = localDateTime;
            
            addResult('âœ… éªŒè¯å™¨åˆå§‹åŒ–å®Œæˆ', 'success');
        });

        function fillTestData() {
            document.getElementById('trade-date').value = '2025-08-04T17:03';
            document.getElementById('quantity').value = '31100';
            document.getElementById('price').value = '19.453';
            document.getElementById('stock-code').value = '000776';
            
            addResult('ğŸ“ æµ‹è¯•æ•°æ®å·²å¡«å……', 'info');
        }

        function clearForm() {
            document.getElementById('test-form').reset();
            
            // æ¸…é™¤æ‰€æœ‰éªŒè¯çŠ¶æ€
            document.querySelectorAll('.is-invalid, .is-valid').forEach(el => {
                el.classList.remove('is-invalid', 'is-valid');
            });
            
            // æ¸…é™¤é”™è¯¯æ¶ˆæ¯
            document.querySelectorAll('.invalid-feedback').forEach(el => {
                el.style.display = 'none';
            });
            
            addResult('ğŸ§¹ è¡¨å•å·²æ¸…ç©º', 'info');
        }

        function testValidation() {
            addResult('ğŸ” å¼€å§‹éªŒè¯æµ‹è¯•...', 'info');
            
            // æ¸…é™¤ä¹‹å‰çš„ç»“æœ
            const resultsDiv = document.getElementById('test-results');
            const existingResults = resultsDiv.querySelectorAll('.test-result:not(.permanent)');
            existingResults.forEach(el => el.remove());
            
            // æµ‹è¯•å„ä¸ªå­—æ®µ
            testField('trade-date', 'äº¤æ˜“æ—¥æœŸ');
            testField('quantity', 'æ•°é‡');
            testField('price', 'ä»·æ ¼');
            testField('stock-code', 'è‚¡ç¥¨ä»£ç ');
            
            // æµ‹è¯•æ•´ä¸ªè¡¨å•
            const isFormValid = validator.validateForm();
            addResult(`ğŸ“‹ æ•´ä½“è¡¨å•éªŒè¯: ${isFormValid ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}`, isFormValid ? 'success' : 'error');
            
            if (!isFormValid) {
                addResult(`é”™è¯¯è¯¦æƒ…: ${JSON.stringify(validator.errors)}`, 'error');
            }
        }

        function testField(fieldId, fieldName) {
            const field = document.getElementById(fieldId);
            const value = field.value;
            
            // éªŒè¯å­—æ®µ
            const isValid = validator.validateField(fieldId);
            
            // æ£€æŸ¥CSSç±»
            const hasInvalidClass = field.classList.contains('is-invalid');
            const hasValidClass = field.classList.contains('is-valid');
            
            addResult(`${fieldName} (${fieldId}):`, 'info');
            addResult(`  å€¼: "${value}"`, 'info');
            addResult(`  éªŒè¯ç»“æœ: ${isValid ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}`, isValid ? 'success' : 'error');
            addResult(`  CSSçŠ¶æ€: is-invalid=${hasInvalidClass}, is-valid=${hasValidClass}`, 'info');
            
            if (!isValid && validator.errors[fieldId]) {
                addResult(`  é”™è¯¯æ¶ˆæ¯: ${validator.errors[fieldId]}`, 'error');
            }
            
            // æ£€æŸ¥çŠ¶æ€ä¸€è‡´æ€§
            if (isValid && hasInvalidClass) {
                addResult(`  âš ï¸ çŠ¶æ€ä¸ä¸€è‡´: éªŒè¯é€šè¿‡ä½†æ˜¾ç¤ºä¸ºæ— æ•ˆ`, 'error');
            } else if (!isValid && hasValidClass) {
                addResult(`  âš ï¸ çŠ¶æ€ä¸ä¸€è‡´: éªŒè¯å¤±è´¥ä½†æ˜¾ç¤ºä¸ºæœ‰æ•ˆ`, 'error');
            } else {
                addResult(`  âœ… çŠ¶æ€ä¸€è‡´`, 'success');
            }
        }

        function addResult(message, type) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.textContent = message;
            resultsDiv.appendChild(resultDiv);
        }
    </script>
</body>
</html>