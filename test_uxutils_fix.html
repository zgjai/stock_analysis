<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UXUtils ä¿®å¤æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>UXUtils ä¿®å¤æµ‹è¯•</h2>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>æµ‹è¯•ç¼ºå¤±çš„å‡½æ•°</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary me-2" onclick="testShowGlobalLoading()">
                            æµ‹è¯• showGlobalLoading
                        </button>
                        <button class="btn btn-warning me-2" onclick="testForceHideAllLoading()">
                            æµ‹è¯• forceHideAllLoading
                        </button>
                        <button class="btn btn-success" onclick="testEditTradeScenario()">
                            æ¨¡æ‹Ÿç¼–è¾‘äº¤æ˜“åœºæ™¯
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>æµ‹è¯•ç»“æœ</h5>
                    </div>
                    <div class="card-body">
                        <div id="test-results"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/utils.js"></script>
    <script>
        function logResult(message, type = 'info') {
            const results = document.getElementById('test-results');
            const alertClass = type === 'success' ? 'alert-success' : 
                              type === 'error' ? 'alert-danger' : 'alert-info';
            
            results.innerHTML += `
                <div class="alert ${alertClass} alert-sm py-2 mb-2">
                    ${new Date().toLocaleTimeString()}: ${message}
                </div>
            `;
            results.scrollTop = results.scrollHeight;
        }

        function testShowGlobalLoading() {
            try {
                logResult('æµ‹è¯• UXUtils.showGlobalLoading...', 'info');
                
                if (typeof UXUtils === 'undefined') {
                    logResult('âŒ UXUtils æœªå®šä¹‰', 'error');
                    return;
                }
                
                if (typeof UXUtils.showGlobalLoading !== 'function') {
                    logResult('âŒ UXUtils.showGlobalLoading ä¸æ˜¯å‡½æ•°', 'error');
                    return;
                }
                
                UXUtils.showGlobalLoading('æµ‹è¯•åŠ è½½ä¸­...');
                logResult('âœ… UXUtils.showGlobalLoading è°ƒç”¨æˆåŠŸ', 'success');
                
                // 3ç§’åè‡ªåŠ¨éšè—
                setTimeout(() => {
                    UXUtils.hideGlobalLoading();
                    logResult('âœ… è‡ªåŠ¨éšè—å…¨å±€åŠ è½½çŠ¶æ€', 'success');
                }, 3000);
                
            } catch (error) {
                logResult(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testForceHideAllLoading() {
            try {
                logResult('æµ‹è¯• UXUtils.forceHideAllLoading...', 'info');
                
                if (typeof UXUtils === 'undefined') {
                    logResult('âŒ UXUtils æœªå®šä¹‰', 'error');
                    return;
                }
                
                if (typeof UXUtils.forceHideAllLoading !== 'function') {
                    logResult('âŒ UXUtils.forceHideAllLoading ä¸æ˜¯å‡½æ•°', 'error');
                    return;
                }
                
                // å…ˆæ˜¾ç¤ºä¸€äº›åŠ è½½çŠ¶æ€
                UXUtils.showGlobalLoading('è¿™ä¸ªåŠ è½½çŠ¶æ€å°†è¢«å¼ºåˆ¶æ¸…ç†...');
                
                // 1ç§’åå¼ºåˆ¶æ¸…ç†
                setTimeout(() => {
                    UXUtils.forceHideAllLoading();
                    logResult('âœ… UXUtils.forceHideAllLoading è°ƒç”¨æˆåŠŸ', 'success');
                }, 1000);
                
            } catch (error) {
                logResult(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testEditTradeScenario() {
            try {
                logResult('æ¨¡æ‹Ÿç¼–è¾‘äº¤æ˜“åœºæ™¯...', 'info');
                
                // æ¨¡æ‹Ÿ editTrade å‡½æ•°ä¸­çš„è°ƒç”¨
                logResult('1. æ˜¾ç¤ºå…¨å±€åŠ è½½çŠ¶æ€', 'info');
                UXUtils.showGlobalLoading('åŠ è½½äº¤æ˜“è®°å½•...');
                
                setTimeout(() => {
                    logResult('2. æ¨¡æ‹Ÿæ•°æ®åŠ è½½å®Œæˆ', 'info');
                    
                    // æ¨¡æ‹Ÿ finally å—ä¸­çš„è°ƒç”¨
                    setTimeout(() => {
                        UXUtils.forceHideAllLoading();
                        logResult('3. âœ… ç¼–è¾‘äº¤æ˜“åœºæ™¯æµ‹è¯•å®Œæˆ', 'success');
                    }, 100);
                }, 2000);
                
            } catch (error) {
                logResult(`âŒ ç¼–è¾‘äº¤æ˜“åœºæ™¯æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            logResult('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æ£€æŸ¥ UXUtils...', 'info');
            
            if (typeof UXUtils === 'undefined') {
                logResult('âŒ UXUtils æœªå®šä¹‰', 'error');
                return;
            }
            
            constFunctions = ['showGlobalLoading', 'forceHideAllLoading', 'hideGlobalLoading'];
            let allFunctionsExist = true;Functions.forEach(funcName => {
                if (typeof UXUtils[funcName] === 'function') {
                    logResult(`âœ… UXUtils.${funcName} å­˜åœ¨`, 'success');
                } else {
                    logResult(`âŒ UXUtils.${funcName} ä¸å­˜åœ¨æˆ–ä¸æ˜¯å‡½æ•°`, 'error');
                    allFunctionsExist = false;
                }
            });
            
            if (allFunctionsExist) {
                logResult('ğŸ‰ æ‰€æœ‰å¿…éœ€çš„ UXUtils å‡½æ•°éƒ½å·²æ­£ç¡®å®šä¹‰ï¼', 'success');
            } else {
                logResult('âš ï¸ éƒ¨åˆ† UXUtils å‡½æ•°ç¼ºå¤±', 'error');
            }
        });
    </script>
</body>
</html>