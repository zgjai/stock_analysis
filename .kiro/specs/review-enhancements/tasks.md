# 实施计划

- [x] 1. 扩展数据模型和数据库结构
  - 为复盘记录表添加当前价格和浮盈比例字段
  - 创建数据库迁移脚本
  - 更新ReviewRecord模型类以支持新字段
  - _需求: 需求3_

- [x] 2. 实现持仓天数编辑后端API
  - 扩展现有的持仓天数更新API以支持完整的CRUD操作
  - 添加数据验证逻辑确保持仓天数为正整数
  - 实现错误处理和响应格式化
  - 编写API单元测试
  - _需求: 需求1_

- [x] 3. 实现浮盈计算后端API
  - 创建浮盈计算API端点
  - 实现根据股票代码获取成本价的逻辑
  - 添加浮盈比例计算算法
  - 实现响应数据格式化
  - 编写计算逻辑的单元测试
  - _需求: 需求3_

- [x] 4. 扩展复盘保存API功能
  - 更新现有复盘创建和更新API以支持新字段
  - 添加当前价格和浮盈比例的数据验证
  - 实现复盘数据的完整性检查
  - 添加保存成功和失败的响应处理
  - 编写保存功能的单元测试
  - _需求: 需求2_

- [x] 5. 扩展前端API客户端
  - 在ApiClient类中添加持仓天数更新方法
  - 添加浮盈计算API调用方法
  - 扩展复盘保存方法以支持新字段
  - 实现错误处理和重试机制
  - _需求: 需求1, 需求2, 需求3_

- [x] 6. 实现持仓天数编辑前端组件
  - 创建HoldingDaysEditor类处理编辑逻辑
  - 实现点击编辑功能，将显示文本转换为输入框
  - 添加输入验证（正整数检查）
  - 实现保存和取消功能
  - 添加加载状态和错误提示
  - _需求: 需求1_

- [x] 7. 实现当前价格输入和浮盈计算前端组件
  - 创建FloatingProfitCalculator类
  - 在复盘模态框中添加当前价格输入字段
  - 实现实时浮盈比例计算和显示
  - 添加颜色编码（绿色为正，红色为负）
  - 实现输入验证和错误处理
  - _需求: 需求3_

- [x] 8. 实现复盘保存管理前端组件
  - 创建ReviewSaveManager类管理保存逻辑
  - 实现表单变化检测机制
  - 添加未保存更改警告功能
  - 实现保存按钮状态管理
  - 添加保存成功和失败的用户反馈
  - _需求: 需求2_

- [x] 9. 更新复盘页面HTML模板
  - 在复盘模态框中添加当前价格输入字段
  - 更新持仓列表显示以支持编辑功能
  - 添加保存状态指示器
  - 更新CSS样式以支持新的UI元素
  - _需求: 需求1, 需求2, 需求3_

- [x] 10. 集成所有组件并测试完整功能
  - 将所有前端组件集成到复盘页面
  - 实现组件间的数据传递和状态同步
  - 测试完整的用户交互流程
  - 验证所有API调用和数据持久化
  - 进行错误场景测试
  - _需求: 需求1, 需求2, 需求3_

- [x] 11. 编写集成测试和端到端测试
  - 创建持仓天数编辑的集成测试
  - 编写复盘保存功能的端到端测试
  - 实现浮盈计算的准确性测试
  - 测试错误处理和边界情况
  - 验证数据一致性和完整性
  - _需求: 需求1, 需求2, 需求3_

- [x] 12. 性能优化和用户体验改进
  - 优化浮盈计算的响应速度
  - 实现自动保存功能以防数据丢失
  - 添加加载动画和进度指示器
  - 优化移动端显示效果
  - 实现键盘快捷键支持
  - _需求: 需求2, 需求3_