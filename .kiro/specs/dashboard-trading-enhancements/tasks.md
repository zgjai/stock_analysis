# 实施计划

- [x] 1. 创建非交易日配置功能
  - 创建NonTradingDay数据模型，支持节假日配置和交易日计算
  - 实现NonTradingDayService服务类，提供交易日判断和持仓天数计算功能
  - 创建非交易日管理API端点，支持增删改查操作
  - 实现前端非交易日配置界面，允许用户添加和管理节假日
  - 编写非交易日功能的单元测试
  - _需求: 8.1, 8.2, 8.3, 8.5, 8.6_

- [x] 2. 增强仪表板收益指标显示
  - 修改AnalyticsService.get_overall_statistics方法，添加已清仓收益和当前持仓收益计算
  - 实现已清仓收益计算逻辑，按股票分组计算完整买卖周期的收益
  - 实现当前持仓收益计算逻辑，结合最新价格计算浮盈浮亏
  - 更新仪表板模板，添加两个新的收益指标卡片显示
  - 修改dashboard.js，更新数据获取和显示逻辑
  - _需求: 1.1, 1.2, 1.3, 1.4_

- [x] 3. 实现科创板股票数量验证规则
  - 创建股票类型识别工具函数，判断是否为科创板股票（68开头）
  - 修改TradeRecord模型的数量验证逻辑，区分科创板和普通股票
  - 更新TradingService中的数量验证方法，应用新的验证规则
  - 修改前端交易表单的数量验证JavaScript代码
  - 更新交易表单的提示文本，根据股票类型显示不同的数量要求
  - _需求: 2.1, 2.2, 2.3_

- [x] 4. 重构交易录入工作流程
  - 修改交易录入模态框，添加交易类型选择步骤
  - 实现当前持仓查询API端点，为卖出操作提供股票选择
  - 创建前端交易类型选择组件，区分买入和卖出流程
  - 修改卖出交易表单，限制只能选择当前持仓的股票
  - 更新交易录入JavaScript逻辑，实现分步骤的用户界面
  - _需求: 3.1, 3.2, 3.3, 3.4_

- [x] 5. 修复止盈目标百分比处理
  - 修改ProfitTakingService中的百分比验证逻辑，正确处理百分比输入
  - 更新止盈目标验证规则，允许大于10%的止盈比例和大于100%的卖出比例
  - 修改前端profit-targets-manager.js，添加百分比符号显示和输入处理
  - 更新交易表单的止盈设置部分，显示百分比符号并正确解析用户输入
  - 修复止盈目标计算逻辑，确保百分比值的正确转换
  - _需求: 4.1, 4.2, 4.3, 4.4_

- [x] 6. 修复月度收益率计算和显示
  - 修改AnalyticsService.get_monthly_statistics方法，实现正确的月度收益率计算
  - 实现月度已完成交易的收益统计逻辑
  - 修复月度数据为空时的处理逻辑，显示适当的指示器
  - 更新仪表板图表显示，确保月度收益率数据正确渲染
  - 添加月度收益率计算的单元测试
  - _需求: 5.1, 5.2, 5.3, 5.4_

- [x] 7. 实现可配置收益分布分析
  - 创建ProfitDistributionConfig数据模型，支持自定义收益区间配置
  - 实现交易配对分析逻辑，正确识别完整的买卖周期
  - 修改AnalyticsService.get_profit_distribution方法，使用可配置的收益区间
  - 创建收益区间配置API端点，支持用户自定义区间设置
  - 实现前端收益分布配置界面，允许用户设置自定义区间
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 8. 清理不需要的界面模块
  - 修改仪表板模板，移除"最近交易"和"持仓提醒"模块
  - 修改复盘分析模板，移除"持仓策略提醒"模块
  - 更新相关的CSS样式，调整布局以适应模块移除
  - 清理相关的JavaScript代码，移除不再需要的功能
  - 确保移除模块后其他功能正常工作
  - _需求: 7.1, 7.2, 7.3, 7.4_

- [x] 9. 增强复盘分析页面持仓天数显示
  - 修改当前持仓查询逻辑，集成非交易日计算功能
  - 更新ReviewService，添加实际持仓天数计算
  - 修改复盘分析模板，在当前持仓列表中显示持仓天数
  - 更新持仓数据的前端显示逻辑，格式化持仓天数显示
  - 添加持仓天数计算的工具提示，说明仅计算交易日
  - _需求: 8.4, 8.7_

- [x] 10. 创建数据库迁移脚本
  - 创建NonTradingDay表的数据库迁移脚本
  - 创建ProfitDistributionConfig表的数据库迁移脚本
  - 为TradeRecord表添加actual_holding_days字段的迁移脚本
  - 创建默认非交易日数据的初始化脚本（周末自动排除）
  - 创建默认收益分布区间配置的初始化脚本
  - _需求: 所有需求的数据库支持_

- [x] 11. 编写综合测试用例
  - 创建仪表板收益指标的集成测试
  - 编写交易录入流程的端到端测试
  - 实现非交易日配置功能的测试用例
  - 创建收益分布分析的准确性测试
  - 编写持仓天数计算的边界条件测试
  - _需求: 所有功能的测试覆盖_

- [x] 12. 性能优化和最终集成
  - 优化复杂收益计算的数据库查询性能
  - 实现收益数据的缓存机制，减少重复计算
  - 优化前端数据加载，实现增量更新
  - 进行全功能集成测试，确保所有新功能协同工作
  - 创建用户文档，说明新功能的使用方法
  - _需求: 系统整体性能和用户体验_