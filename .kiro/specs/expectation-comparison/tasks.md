# 期望对比功能实施计划

- [x] 1. 创建后端服务和API基础架构
  - 创建ExpectationComparisonService服务类，实现期望值计算逻辑
  - 实现概率模型定义和期望指标计算方法
  - 创建数据传输对象（DTO）类定义
  - _需求: 2.2, 2.3, 2.4_

- [x] 2. 实现期望值计算核心逻辑
  - 实现基于8个概率场景的期望收益率计算
  - 实现期望持仓天数和期望胜率计算
  - 实现基于320万本金的期望收益金额计算
  - 编写期望值计算的单元测试
  - _需求: 2.2, 2.4, 7.1, 7.2_

- [x] 3. 实现实际数据处理和标准化
  - 实现实际交易数据的收益率计算逻辑
  - 实现实际数据标准化到320万本金的计算
  - 实现实际持仓天数和胜率统计
  - 实现时间范围筛选功能
  - _需求: 3.1, 3.2, 3.3, 3.4, 6.1, 6.2, 7.3_

- [x] 4. 创建对比分析API端点
  - 在analytics_routes.py中添加期望对比API端点
  - 实现GET /api/analytics/expectation-comparison路由
  - 实现时间范围参数处理和验证
  - 实现API响应格式和错误处理
  - _需求: 2.1, 6.1, 6.2, 6.3, 8.1, 8.2_

- [x] 5. 扩展前端analytics页面结构
  - 在analytics.html中添加tab导航结构
  - 创建期望对比tab的HTML内容区域
  - 添加时间范围选择器组件
  - 确保与现有analytics功能的兼容性
  - _需求: 1.1, 1.2, 1.3, 6.1, 8.5_

- [x] 6. 实现前端期望对比管理器
  - 创建ExpectationComparisonManager JavaScript类
  - 实现数据加载和API调用逻辑
  - 实现时间范围筛选功能
  - 实现错误处理和加载状态管理
  - _需求: 1.1, 1.2, 6.2, 6.3, 8.1_

- [x] 7. 实现收益对比可视化图表
  - 使用Chart.js创建收益率对比柱状图
  - 实现收益金额对比图表（基于320万本金）
  - 添加图表交互功能和数据标签
  - 实现图表响应式设计
  - _需求: 4.1, 4.2, 4.5, 4.6, 7.4_

- [x] 8. 实现持仓天数和胜率对比图表
  - 创建持仓天数对比柱状图
  - 实现胜率对比环形图或饼图
  - 添加图表颜色区分（实际vs期望）
  - 实现图表数据更新机制
  - _需求: 4.3, 4.4, 4.5, 4.6_

- [x] 9. 实现差异分析和提示功能
  - 计算并显示收益率和收益金额差异
  - 实现持仓天数差异计算和显示
  - 添加差异状态的颜色标识（绿色/红色/黄色）
  - 实现差异提示文本（超出期望/低于期望/接近期望）
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 10. 集成测试和功能验证
  - 测试期望对比API的完整功能
  - 验证前端页面的tab切换和数据加载
  - 测试不同时间范围的数据筛选
  - 验证图表渲染和交互功能
  - _需求: 1.3, 6.3, 6.4, 8.3, 8.4_

- [x] 11. 数据完整性和兼容性测试
  - 验证现有analytics功能不受影响
  - 测试新功能对现有数据的只读访问
  - 验证错误情况下的系统稳定性
  - 测试不同数据量下的性能表现
  - _需求: 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 12. 用户体验优化和最终调试
  - 优化页面加载性能和响应速度
  - 完善错误提示和用户引导
  - 调整图表样式和布局
  - 进行最终的功能测试和bug修复
  - _需求: 1.1, 4.6, 6.4, 8.1_