# 期望对比功能需求文档

## 介绍

期望对比功能是一个新的分析模块，用于将用户的实际交易表现与基于概率模型的期望目标进行对比分析。该功能通过图表可视化展示实际收益、平均持仓天数等核心指标与预设期望值的差异，帮助用户评估交易策略的有效性。

## 需求

### 需求 1：期望对比Tab页面

**用户故事：** 作为交易者，我希望有一个专门的"期望对比"标签页，这样我可以快速访问实际表现与期望目标的对比分析。

#### 验收标准

1. WHEN 用户访问系统主界面 THEN 系统 SHALL 在现有tab基础上显示"期望对比"标签页
2. WHEN 用户点击"期望对比"标签 THEN 系统 SHALL 切换到期望对比分析界面
3. WHEN 切换到期望对比页面 THEN 系统 SHALL 保持其他现有功能和数据完全不受影响

### 需求 2：期望目标配置管理

**用户故事：** 作为交易者，我希望系统能够基于预设的概率模型自动计算期望目标，这样我可以有明确的基准进行对比。

#### 验收标准

1. WHEN 系统初始化期望目标 THEN 系统 SHALL 基于以下概率模型计算期望值：
   - 10%概率盈利20%，最大持仓30天
   - 10%概率盈利15%，最大持仓20天  
   - 15%概率盈利10%，最大持仓15天
   - 15%概率盈利5%，最大持仓10天
   - 10%概率盈利2%，最大持仓5天
   - 20%概率亏损3%，最大持仓5天
   - 15%概率亏损5%，最大持仓5天
   - 5%概率亏损10%，最大持仓5天
2. WHEN 计算期望收益率 THEN 系统 SHALL 使用公式：期望收益率 = Σ(概率 × 收益率)
3. WHEN 计算期望持仓天数 THEN 系统 SHALL 使用公式：期望持仓天数 = Σ(概率 × 最大持仓天数)
4. WHEN 计算期望收益金额 THEN 系统 SHALL 基于320万起始本金和期望收益率计算期望总收益金额
5. WHEN 设定资金分配 THEN 系统 SHALL 假设同时持仓10只股票，每只分配总资金的1/10

### 需求 3：实际数据统计计算

**用户故事：** 作为交易者，我希望系统能够准确统计我的实际交易表现，这样我可以与期望目标进行有意义的对比。

#### 验收标准

1. WHEN 计算实际总收益率 THEN 系统 SHALL 基于所有已完成交易计算加权平均收益率
2. WHEN 计算实际平均持仓天数 THEN 系统 SHALL 基于所有已完成交易计算平均持仓时长
3. WHEN 计算实际胜率 THEN 系统 SHALL 计算盈利交易占总交易的百分比
4. WHEN 计算实际收益金额 THEN 系统 SHALL 基于320万起始本金计算实际总收益金额
5. WHEN 统计实际数据 THEN 系统 SHALL 只包含已完成（已卖出）的交易记录
6. WHEN 处理当前持仓 THEN 系统 SHALL 单独统计但不计入完成交易的对比分析

### 需求 4：对比数据可视化

**用户故事：** 作为交易者，我希望通过直观的图表看到实际表现与期望目标的对比，这样我可以快速识别差异和改进方向。

#### 验收标准

1. WHEN 显示收益率对比 THEN 系统 SHALL 使用柱状图或雷达图展示实际vs期望收益率
2. WHEN 显示收益金额对比 THEN 系统 SHALL 使用柱状图展示实际vs期望收益金额（基于320万本金）
3. WHEN 显示持仓天数对比 THEN 系统 SHALL 使用柱状图展示实际vs期望平均持仓天数  
4. WHEN 显示胜率对比 THEN 系统 SHALL 使用饼图或环形图展示实际vs期望胜率
5. WHEN 展示图表 THEN 系统 SHALL 使用不同颜色区分实际值和期望值
6. WHEN 图表加载 THEN 系统 SHALL 显示加载状态并在数据准备完成后渲染图表

### 需求 5：差异分析和提示

**用户故事：** 作为交易者，我希望系统能够分析实际表现与期望的差异，并提供有意义的提示，这样我可以了解策略的优劣势。

#### 验收标准

1. WHEN 计算收益率差异 THEN 系统 SHALL 显示实际收益率与期望收益率的差值和百分比差异
2. WHEN 计算收益金额差异 THEN 系统 SHALL 显示实际收益金额与期望收益金额的差值
3. WHEN 计算持仓天数差异 THEN 系统 SHALL 显示实际持仓天数与期望持仓天数的差值
4. WHEN 差异为正值 THEN 系统 SHALL 使用绿色显示并标注"超出期望"
5. WHEN 差异为负值 THEN 系统 SHALL 使用红色显示并标注"低于期望"
6. WHEN 差异在±5%范围内 THEN 系统 SHALL 使用黄色显示并标注"接近期望"

### 需求 6：时间范围筛选

**用户故事：** 作为交易者，我希望能够选择不同的时间范围进行对比分析，这样我可以评估不同时期的策略表现。

#### 验收标准

1. WHEN 用户访问期望对比页面 THEN 系统 SHALL 提供时间范围选择器（最近30天、最近90天、最近1年、全部时间）
2. WHEN 用户选择时间范围 THEN 系统 SHALL 重新计算该时间段内的实际数据
3. WHEN 时间范围变更 THEN 系统 SHALL 更新所有图表和统计数据
4. WHEN 选择的时间范围内无交易数据 THEN 系统 SHALL 显示"暂无数据"提示

### 需求 7：本金基准设定

**用户故事：** 作为交易者，我希望系统使用固定的本金基准进行收益计算，这样我可以得到标准化的收益对比结果。

#### 验收标准

1. WHEN 系统计算期望收益金额 THEN 系统 SHALL 使用320万作为基准本金
2. WHEN 系统计算实际收益金额 THEN 系统 SHALL 将实际收益率应用到320万基准本金上
3. WHEN 显示收益金额 THEN 系统 SHALL 明确标注基于320万本金的计算结果
4. WHEN 用户查看收益对比 THEN 系统 SHALL 同时显示收益率和基于320万本金的收益金额
5. WHEN 计算收益差异 THEN 系统 SHALL 提供收益率差异和收益金额差异两个维度的对比

### 需求 8：数据完整性保护

**用户故事：** 作为系统用户，我希望新功能不会影响现有的任何数据和功能，这样我可以安全地使用新功能。

#### 验收标准

1. WHEN 实现期望对比功能 THEN 系统 SHALL 确保所有现有交易数据保持完整
2. WHEN 添加新功能 THEN 系统 SHALL 确保现有的所有页面和功能正常工作
3. WHEN 进行数据查询 THEN 系统 SHALL 只进行只读操作，不修改任何现有数据
4. WHEN 新功能出现错误 THEN 系统 SHALL 不影响其他功能的正常使用
5. WHEN 用户切换到其他tab THEN 系统 SHALL 保持原有功能的完整性和数据一致性