<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交易记录修复测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="static/css/main.css" rel="stylesheet">
    <link href="static/css/components.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>交易记录修复测试页面</h1>
        
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>修复内容测试</h5>
                    </div>
                    <div class="card-body">
                        <h6>1. 分批止盈输入框宽度测试</h6>
                        <div class="profit-targets-manager mb-4">
                            <div class="target-row p-3 border rounded">
                                <div class="row align-items-center">
                                    <div class="col-md-3">
                                        <label class="form-label small">止盈比例 <span class="text-danger">*</span></label>
                                        <div class="input-group input-group-sm">
                                            <input type="number" 
                                                   class="form-control target-input profit-ratio-input" 
                                                   value="25.50" 
                                                   step="0.01" 
                                                   min="0.01" 
                                                   max="1000"
                                                   placeholder="20.00"
                                                   style="min-width: 120px;">
                                            <span class="input-group-text">%</span>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-2">
                                        <label class="form-label small">止盈价格</label>
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text">¥</span>
                                            <input type="number" 
                                                   class="form-control target-input target-price-input" 
                                                   value="24.39" 
                                                   step="0.01" 
                                                   min="0.01" 
                                                   placeholder="0.00"
                                                   readonly>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-3">
                                        <label class="form-label small">卖出比例 <span class="text-danger">*</span></label>
                                        <div class="input-group input-group-sm">
                                            <input type="number" 
                                                   class="form-control target-input sell-ratio-input" 
                                                   value="30.00" 
                                                   step="0.01" 
                                                   min="0.01" 
                                                   max="100" 
                                                   placeholder="30.00"
                                                   style="min-width: 120px;">
                                            <span class="input-group-text">%</span>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-2">
                                        <label class="form-label small">预期收益率</label>
                                        <div class="form-control-plaintext small">
                                            <span class="expected-profit-ratio fw-bold text-success">7.65%</span>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-2 text-end">
                                        <span class="badge bg-secondary me-2">#1</span>
                                        <button type="button" class="btn btn-sm btn-outline-danger">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <h6>2. 加载状态测试</h6>
                        <div class="mb-4">
                            <button type="button" class="btn btn-primary" onclick="testLoadingStates()">
                                测试加载状态
                            </button>
                            <button type="button" class="btn btn-warning" onclick="testForceCleanup()">
                                测试强制清理
                            </button>
                        </div>
                        
                        <h6>3. 表单验证测试</h6>
                        <div class="mb-4">
                            <form id="test-form">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="test-stock-code" class="form-label">股票代码</label>
                                        <input type="text" class="form-control" id="test-stock-code" 
                                               value="000776" maxlength="6" pattern="[0-9]{6}">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="test-stock-name" class="form-label">股票名称</label>
                                        <input type="text" class="form-control" id="test-stock-name" 
                                               value="广发证券">
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <button type="button" class="btn btn-success" onclick="testFormValidation()">
                                        测试表单验证
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <div class="alert alert-info">
                            <h6>测试说明：</h6>
                            <ul class="mb-0">
                                <li><strong>输入框宽度：</strong>止盈比例和卖出比例输入框应该有足够宽度显示完整内容</li>
                                <li><strong>加载状态：</strong>点击"测试加载状态"应该能正常显示和隐藏加载状态</li>
                                <li><strong>强制清理：</strong>点击"测试强制清理"应该能清理所有遗留的加载状态</li>
                                <li><strong>表单验证：</strong>股票代码字段应该能正确识别已填写的值</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="static/js/utils.js"></script>
    
    <script>
        // 测试加载状态
        function testLoadingStates() {
            console.log('Testing loading states...');
            
            // 显示全局加载
            UXUtils.showGlobalLoading('测试加载中...');
            
            // 3秒后自动隐藏
            setTimeout(() => {
                UXUtils.hideGlobalLoading();
                UXUtils.showSuccess('加载状态测试完成');
            }, 3000);
        }
        
        // 测试强制清理
        function testForceCleanup() {
            console.log('Testing force cleanup...');
            
            // 先显示一些加载状态
            UXUtils.showGlobalLoading('这个加载状态将被强制清理...');
            
            // 1秒后强制清理
            setTimeout(() => {
                UXUtils.forceHideAllLoading();
                UXUtils.showSuccess('强制清理测试完成');
            }, 1000);
        }
        
        // 测试表单验证
        function testFormValidation() {
            console.log('Testing form validation...');
            
            const stockCodeField = document.getElementById('test-stock-code');
            const stockNameField = document.getElementById('test-stock-name');
            
            // 模拟表单验证触发
            if (stockCodeField.value) {
                stockCodeField.classList.add('is-valid');
                console.log('Stock code validation passed:', stockCodeField.value);
            }
            
            if (stockNameField.value) {
                stockNameField.classList.add('is-valid');
                console.log('Stock name validation passed:', stockNameField.value);
            }
            
            // 触发input事件
            stockCodeField.dispatchEvent(new Event('input', { bubbles: true }));
            stockNameField.dispatchEvent(new Event('input', { bubbles: true }));
            
            UXUtils.showSuccess('表单验证测试完成');
        }
        
        // 页面加载完成后的测试
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Test page loaded');
            
            // 测试CSS样式是否正确应用
            const profitRatioInputs = document.querySelectorAll('.profit-ratio-input');
            const sellRatioInputs = document.querySelectorAll('.sell-ratio-input');
            
            profitRatioInputs.forEach(input => {
                const computedStyle = window.getComputedStyle(input);
                console.log('Profit ratio input min-width:', computedStyle.minWidth);
            });
            
            sellRatioInputs.forEach(input => {
                const computedStyle = window.getComputedStyle(input);
                console.log('Sell ratio input min-width:', computedStyle.minWidth);
            });
        });
    </script>
</body>
</html>