# 股票交易记录和复盘系统 - 用户使用手册

## 目录
- [系统简介](#系统简介)
- [安装和启动](#安装和启动)
- [功能模块使用指南](#功能模块使用指南)
- [数据管理](#数据管理)
- [常见问题](#常见问题)
- [技术支持](#技术支持)

## 系统简介

股票交易记录和复盘系统是一个个人投资管理工具，帮助您：
- 记录每日交易操作
- 进行持仓复盘分析
- 管理股票观察池
- 分析板块热点
- 统计投资收益

### 系统特点
- **本地运行**: 数据存储在本地，保护隐私
- **Git同步**: 支持通过Git在多设备间同步数据
- **响应式设计**: 支持电脑和手机访问
- **实时数据**: 集成AKShare获取股票实时价格

## 安装和启动

### 系统要求
- Python 3.8 或更高版本
- 8GB 内存（推荐）
- 1GB 可用磁盘空间

### 快速启动

#### Windows用户
1. 双击运行 `start.bat`
2. 等待依赖安装完成
3. 浏览器自动打开系统页面

#### macOS/Linux用户
1. 打开终端，进入项目目录
2. 运行 `./start.sh`
3. 在浏览器中访问 `http://localhost:5000`

#### 手动启动
```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 初始化数据库
python init_db.py

# 3. 启动应用
python run.py
```

### 首次使用设置
1. 系统启动后会自动创建数据库
2. 访问 `http://localhost:5000` 进入主页
3. 建议先在"配置管理"中设置买入卖出原因选项

## 功能模块使用指南

### 1. 交易记录管理

#### 添加交易记录
1. 点击导航栏"交易记录"
2. 点击"添加交易记录"按钮
3. 填写交易信息：
   - **股票代码**: 6位数字代码（如：000001）
   - **股票名称**: 自动获取或手动输入
   - **交易类型**: 买入/卖出
   - **价格**: 交易价格
   - **数量**: 交易股数
   - **交易时间**: 默认当前时间
   - **操作原因**: 从预设选项中选择
   - **备注**: 可选的详细说明

#### 买入记录特殊设置
- **止损价格**: 设置止损价位
- **止盈比例**: 设置目标收益率（如：0.2表示20%）
- **卖出比例**: 达到止盈时的卖出比例（如：0.5表示卖出50%）

系统会自动计算：
- 预计亏损比例
- 预计收益率
- 风险收益比

#### 交易记录订正
如果发现交易记录有误：
1. 在交易记录列表中找到错误记录
2. 点击"订正"按钮
3. 修改错误信息
4. 填写订正原因
5. 确认提交

系统会保留原始记录并创建订正记录，可查看完整的修改历史。

### 2. 复盘分析

#### 持仓复盘
1. 进入"复盘分析"页面
2. 系统自动显示当前持仓股票
3. 选择要复盘的股票
4. 进行5项评分（每项0-1分）：
   - 收盘价上升
   - 不破BBI线
   - 无放量阴线
   - 趋势还在向上
   - J没死叉
5. 系统自动计算总分（0-5分）
6. 记录分析内容和决策

#### 持仓策略提醒
系统根据配置的策略规则自动生成操作建议：
- **清仓建议**: 基于亏损阈值或持仓天数
- **部分止盈**: 基于盈利阈值和回撤情况
- **继续持有**: 未触发任何卖出条件

### 3. 股票池管理

#### 添加股票到观察池
1. 进入"股票池管理"页面
2. 点击"添加到观察池"
3. 输入股票代码、名称、目标价位
4. 填写添加原因

#### 股票池状态管理
- **待观测池**: 关注但暂不买入的股票
- **待买入池**: 准备买入的股票
- **已移除**: 不再关注的股票

可以在不同状态间移动股票，系统会记录完整的流转历史。

### 4. 板块分析

#### 获取板块数据
1. 进入"板块分析"页面
2. 点击"刷新板块数据"按钮
3. 系统通过AKShare获取最新板块涨跌幅数据

#### 查看板块排名
- **当日排名**: 显示当日板块涨幅排行榜
- **历史表现**: 查看指定时间范围的板块表现
- **TOPK统计**: 显示最近N天上涨排名前K的板块

### 5. 案例管理

#### 上传股票截图
1. 进入"案例管理"页面
2. 点击"上传案例"
3. 选择图片文件（支持PNG、JPG、JPEG、GIF、BMP）
4. 填写股票代码、标题、标签
5. 添加分析备注

#### 案例搜索和分类
- 按股票代码搜索
- 按标签筛选
- 按时间范围查看
- 支持模糊搜索

### 6. 统计分析

#### 收益统计
- **总体收益**: 已清仓收益 + 持仓浮盈浮亏
- **收益分布**: 按盈亏区间显示股票分布
- **成功率**: 盈利交易占比

#### 月度统计
- 每月交易次数
- 月度收益情况
- 月度成功率变化

#### 数据导出
点击"导出Excel"可将统计数据导出为Excel文件。

## 数据管理

### 数据存储位置
- **数据库文件**: `data/trading_journal.db`
- **上传图片**: `uploads/` 目录
- **日志文件**: `logs/` 目录
- **备份文件**: `backups/` 目录

### 数据备份
系统提供多种备份方式：

#### 自动备份
- 系统每7天自动创建数据库备份
- 备份文件保存在 `backups/` 目录
- 自动清理30天前的旧备份

#### 手动备份
```bash
# 创建备份
python -c "from services.backup_service import BackupService; BackupService().create_backup()"

# 恢复备份
python -c "from services.backup_service import BackupService; BackupService().restore_backup('backup_filename.db')"
```

### Git同步设置
详见 [GIT_SYNC_GUIDE.md](GIT_SYNC_GUIDE.md)

## 常见问题

### Q: 系统启动失败怎么办？
A: 检查以下几点：
1. Python版本是否为3.8+
2. 是否安装了所有依赖包
3. 查看 `logs/trading_journal.log` 中的错误信息

### Q: 股票价格无法获取？
A: 可能的原因：
1. 网络连接问题
2. AKShare服务暂时不可用
3. 股票代码输入错误

### Q: 图片上传失败？
A: 检查：
1. 图片格式是否支持（PNG、JPG、JPEG、GIF、BMP）
2. 图片大小是否超过16MB
3. `uploads/` 目录是否有写入权限

### Q: 数据丢失怎么办？
A: 
1. 检查 `backups/` 目录中的备份文件
2. 使用备份恢复功能
3. 如果使用Git同步，可以从远程仓库恢复

### Q: 如何修改买入卖出原因选项？
A: 
1. 进入数据库管理工具
2. 修改 `configurations` 表中的相关配置
3. 或者通过API接口修改配置

## 技术支持

### 日志查看
系统运行日志保存在 `logs/trading_journal.log`，包含：
- 系统启动信息
- 错误信息
- API调用记录
- 数据库操作记录

### 性能优化建议
1. 定期清理旧的日志文件
2. 定期备份并清理过期数据
3. 避免上传过大的图片文件
4. 合理设置价格缓存时间

### 系统升级
1. 备份当前数据
2. 下载新版本代码
3. 运行数据库迁移脚本
4. 重启系统

### 联系方式
如遇到技术问题，请：
1. 查看日志文件获取详细错误信息
2. 检查GitHub Issues中是否有类似问题
3. 提交新的Issue并附上错误日志

---

**注意**: 本系统为个人投资管理工具，所有投资决策请谨慎考虑，系统提供的分析和建议仅供参考。