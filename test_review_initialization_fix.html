<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ç›˜é¡µé¢åˆå§‹åŒ–ä¿®å¤æµ‹è¯•</title>
</head>
<body>
    <h1>å¤ç›˜é¡µé¢åˆå§‹åŒ–ä¿®å¤æµ‹è¯•</h1>
    <div id="test-results"></div>

    <script>
        // æ¨¡æ‹Ÿå¿…è¦çš„å‡½æ•°
        function logInitializationProgress(name, status, data) {
            console.log(`[${status}] ${name}:`, data);
        }

        function checkDependencies() {
            console.log('æ£€æŸ¥ä¾èµ–...');
            return true;
        }

        function initializeApiClient() {
            console.log('åˆå§‹åŒ–APIå®¢æˆ·ç«¯...');
            return true;
        }

        function initializeReviewSaveManager() {
            console.log('åˆå§‹åŒ–ä¿å­˜ç®¡ç†å™¨...');
            return true;
        }

        function bindReviewEvents() {
            console.log('ç»‘å®šäº‹ä»¶...');
            return true;
        }

        function integrateReviewSaveStateManagement() {
            console.log('é›†æˆä¿å­˜çŠ¶æ€ç®¡ç†...');
            return true;
        }

        function loadAllData() {
            console.log('åŠ è½½æ•°æ®...');
            return true;
        }

        function initializeBootstrapModal() {
            console.log('åˆå§‹åŒ–Bootstrapæ¨¡æ€æ¡†...');
        }

        function performPostInitializationTasks() {
            console.log('æ‰§è¡Œåç»­åˆå§‹åŒ–ä»»åŠ¡...');
        }

        function showErrorMessage(msg) {
            console.error('é”™è¯¯æ¶ˆæ¯:', msg);
        }

        function showSuccessMessage(msg) {
            console.log('æˆåŠŸæ¶ˆæ¯:', msg);
        }

        function showWarningMessage(msg) {
            console.warn('è­¦å‘Šæ¶ˆæ¯:', msg);
        }

        function verifySaveStateManagementIntegration() {
            console.log('éªŒè¯ä¿å­˜çŠ¶æ€ç®¡ç†é›†æˆ...');
        }

        // å¤åˆ¶ä¿®å¤åçš„ initializeReviewPage å‡½æ•°
        function initializeReviewPage() {
            console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–å¤ç›˜é¡µé¢');
            console.time('é¡µé¢åˆå§‹åŒ–è€—æ—¶');

            // è®°å½•åˆå§‹åŒ–å¼€å§‹
            if (typeof logInitializationProgress === 'function') {
                logInitializationProgress('å¤ç›˜é¡µé¢åˆå§‹åŒ–', 'start', {
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    url: window.location.href
                });
            }

            // å®šä¹‰åˆå§‹åŒ–æ­¥éª¤ï¼ŒæŒ‰ä¾èµ–é¡ºåºæ’åˆ—
            const initSteps = [
                {
                    name: 'ä¾èµ–æ£€æŸ¥',
                    fn: checkDependencies,
                    critical: true,
                    description: 'æ£€æŸ¥JavaScriptä¾èµ–æ˜¯å¦æ­£ç¡®åŠ è½½'
                },
                {
                    name: 'APIå®¢æˆ·ç«¯åˆå§‹åŒ–',
                    fn: initializeApiClient,
                    critical: true,
                    description: 'åˆå§‹åŒ–APIå®¢æˆ·ç«¯å®ä¾‹'
                },
                {
                    name: 'ä¿å­˜ç®¡ç†å™¨åˆå§‹åŒ–',
                    fn: initializeReviewSaveManager,
                    critical: true,
                    description: 'åˆå§‹åŒ–å¤ç›˜ä¿å­˜ç®¡ç†å™¨å®ä¾‹'
                },
                {
                    name: 'äº‹ä»¶ç»‘å®š',
                    fn: bindReviewEvents,
                    critical: false,
                    description: 'ç»‘å®šé¡µé¢äº‹ä»¶å¤„ç†å™¨'
                },
                {
                    name: 'ä¿å­˜çŠ¶æ€ç®¡ç†é›†æˆ',
                    fn: integrateReviewSaveStateManagement,
                    critical: false,
                    description: 'é›†æˆä¿å­˜çŠ¶æ€ç®¡ç†åŠŸèƒ½'
                },
                {
                    name: 'æ•°æ®åŠ è½½',
                    fn: loadAllData,
                    critical: false,
                    description: 'åŠ è½½é¡µé¢åˆå§‹æ•°æ®'
                }
            ];

            let successCount = 0;
            let criticalFailure = false;
            const results = [];

            // åˆ†æ­¥æ‰§è¡Œåˆå§‹åŒ–
            for (let i = 0; i < initSteps.length; i++) {
                const step = initSteps[i];
                const stepStartTime = performance.now();

                console.group(`ğŸ“‹ æ­¥éª¤ ${i + 1}/${initSteps.length}: ${step.name}`);
                console.log(`ğŸ“ æè¿°: ${step.description}`);
                console.log(`ğŸ”§ å¼€å§‹æ‰§è¡Œ...`);

                try {
                    const result = step.fn();
                    const stepEndTime = performance.now();
                    const stepDuration = (stepEndTime - stepStartTime).toFixed(2);

                    if (result === false) {
                        console.error(`âŒ ${step.name}å¤±è´¥`);
                        console.log(`â±ï¸ è€—æ—¶: ${stepDuration}ms`);

                        results.push({
                            step: step.name,
                            success: false,
                            error: 'å‡½æ•°è¿”å›false',
                            duration: stepDuration,
                            critical: step.critical
                        });

                        if (step.critical) {
                            console.error(`ğŸš¨ å…³é”®æ­¥éª¤å¤±è´¥ï¼Œåœæ­¢åç»­åˆå§‹åŒ–`);
                            criticalFailure = true;
                            console.groupEnd();
                            break;
                        }
                    } else {
                        console.log(`âœ… ${step.name}æˆåŠŸ`);
                        console.log(`â±ï¸ è€—æ—¶: ${stepDuration}ms`);
                        successCount++;

                        results.push({
                            step: step.name,
                            success: true,
                            duration: stepDuration,
                            critical: step.critical
                        });
                    }
                } catch (error) {
                    const stepEndTime = performance.now();
                    const stepDuration = (stepEndTime - stepStartTime).toFixed(2);

                    console.error(`âŒ ${step.name}å¼‚å¸¸:`, error);
                    console.log(`â±ï¸ è€—æ—¶: ${stepDuration}ms`);

                    results.push({
                        step: step.name,
                        success: false,
                        error: error.message || error.toString(),
                        duration: stepDuration,
                        critical: step.critical
                    });

                    if (step.critical) {
                        console.error(`ğŸš¨ å…³é”®æ­¥éª¤å¼‚å¸¸ï¼Œåœæ­¢åç»­åˆå§‹åŒ–`);
                        criticalFailure = true;
                        console.groupEnd();
                        break;
                    }
                }

                console.groupEnd();
            }

            console.timeEnd('é¡µé¢åˆå§‹åŒ–è€—æ—¶');

            // è®°å½•åˆå§‹åŒ–ç»“æœ
            console.group('ğŸ“Š åˆå§‹åŒ–ç»“æœæ±‡æ€»');
            console.table(results);
            console.log(`âœ… æˆåŠŸæ­¥éª¤: ${successCount}/${initSteps.length}`);
            console.log(`âŒ å¤±è´¥æ­¥éª¤: ${initSteps.length - successCount}/${initSteps.length}`);
            console.log(`ğŸš¨ å…³é”®å¤±è´¥: ${criticalFailure ? 'æ˜¯' : 'å¦'}`);
            console.groupEnd();

            // æ ¹æ®ç»“æœè¿”å›ç›¸åº”å€¼
            if (criticalFailure) {
                console.error('ğŸš¨ å¤ç›˜é¡µé¢åˆå§‹åŒ–å¤±è´¥ï¼Œå…³é”®åŠŸèƒ½æ— æ³•ä½¿ç”¨');
                if (typeof showErrorMessage === 'function') {
                    showErrorMessage('é¡µé¢åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                }
                return false;
            } else if (successCount === initSteps.length) {
                console.log('ğŸ‰ å¤ç›˜é¡µé¢åˆå§‹åŒ–å®Œå…¨æˆåŠŸ');
                if (typeof showSuccessMessage === 'function') {
                    showSuccessMessage('å¤ç›˜é¡µé¢åˆå§‹åŒ–æˆåŠŸ');
                }
                return true;
            } else {
                console.warn('âš ï¸ å¤ç›˜é¡µé¢åˆå§‹åŒ–éƒ¨åˆ†æˆåŠŸï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨');
                if (typeof showWarningMessage === 'function') {
                    showWarningMessage(`é¡µé¢åˆå§‹åŒ–éƒ¨åˆ†æˆåŠŸ (${successCount}/${initSteps.length})ï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½å—é™`);
                }
                return true;
            }
        }

        // æµ‹è¯•ä¿®å¤åçš„åˆå§‹åŒ–ä»£ç 
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”§ å¼€å§‹æµ‹è¯•ä¿®å¤åçš„åˆå§‹åŒ–ä»£ç ');
            console.log('ğŸ“… åˆå§‹åŒ–æ—¶é—´:', new Date().toLocaleString('zh-CN'));
            console.log('ğŸŒ ç”¨æˆ·ä»£ç†:', navigator.userAgent);

            try {
                // æ‰§è¡Œä¸»åˆå§‹åŒ–æµç¨‹ - ä¿®å¤åçš„ç‰ˆæœ¬
                const initSuccess = initializeReviewPage();
                
                // åˆå§‹åŒ–Bootstrapæ¨¡æ€æ¡†ï¼ˆç‹¬ç«‹äºä¸»æµç¨‹ï¼‰
                initializeBootstrapModal()

                // è®°å½•åˆå§‹åŒ–å®Œæˆ
                console.log('ğŸ å¤ç›˜é¡µé¢åˆå§‹åŒ–æµç¨‹å®Œæˆ');
                console.log('ğŸ“Š åˆå§‹åŒ–ç»“æœ:', initSuccess ? 'æˆåŠŸ' : 'å¤±è´¥');

                // å¦‚æœåˆå§‹åŒ–æˆåŠŸï¼Œæ‰§è¡Œåç»­æ“ä½œ
                if (initSuccess) {
                    console.log('ğŸ¯ å¼€å§‹æ‰§è¡Œåç»­åˆå§‹åŒ–æ“ä½œ');

                    // å»¶è¿Ÿæ‰§è¡Œéå…³é”®æ“ä½œï¼Œé¿å…é˜»å¡ä¸»æµç¨‹
                    setTimeout(() => {
                        performPostInitializationTasks();
                    }, 100);
                } else {
                    console.error('ğŸš¨ åˆå§‹åŒ–å¤±è´¥ï¼Œé¡µé¢åŠŸèƒ½å¯èƒ½å—é™');
                }

                // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
                document.getElementById('test-results').innerHTML = `
                    <div style="padding: 20px; border: 2px solid ${initSuccess ? 'green' : 'red'}; border-radius: 5px; margin: 20px 0;">
                        <h2>æµ‹è¯•ç»“æœ</h2>
                        <p><strong>åˆå§‹åŒ–çŠ¶æ€:</strong> ${initSuccess ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}</p>
                        <p><strong>é”™è¯¯ä¿®å¤:</strong> âœ… å·²ä¿®å¤ "initializeReviewPage(...).then is not a function" é”™è¯¯</p>
                        <p><strong>æµ‹è¯•æ—¶é—´:</strong> ${new Date().toLocaleString('zh-CN')}</p>
                        <p><strong>è¯´æ˜:</strong> å‡½æ•°ç°åœ¨æ­£ç¡®è¿”å›å¸ƒå°”å€¼ï¼Œä¸å†å°è¯•è°ƒç”¨ .then() æ–¹æ³•</p>
                    </div>
                `;

            } catch (error) {
                console.error('ğŸš¨ é¡µé¢åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿæœªæ•è·çš„å¼‚å¸¸:', error);
                console.error('é”™è¯¯æ¶ˆæ¯:', error.message);
                
                document.getElementById('test-results').innerHTML = `
                    <div style="padding: 20px; border: 2px solid red; border-radius: 5px; margin: 20px 0;">
                        <h2>æµ‹è¯•ç»“æœ</h2>
                        <p><strong>çŠ¶æ€:</strong> âŒ ä»æœ‰é”™è¯¯</p>
                        <p><strong>é”™è¯¯:</strong> ${error.message}</p>
                        <p><strong>æµ‹è¯•æ—¶é—´:</strong> ${new Date().toLocaleString('zh-CN')}</p>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>