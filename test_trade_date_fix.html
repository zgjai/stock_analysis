<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交易日期编辑测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>交易日期编辑测试</h2>
        
        <div class="card">
            <div class="card-body">
                <h5>测试步骤</h5>
                <ol>
                    <li>打开交易记录页面</li>
                    <li>点击编辑某条交易记录</li>
                    <li>修改交易日期</li>
                    <li>保存记录</li>
                    <li>重新打开该记录，检查日期是否已更新</li>
                </ol>
                
                <h5 class="mt-4">调试信息</h5>
                <div id="debug-info" class="border p-3 bg-light">
                    <p>请打开浏览器开发者工具的控制台，查看以下调试信息：</p>
                    <ul>
                        <li><code>[DEBUG] 从DOM获取交易日期: ...</code></li>
                        <li><code>[DEBUG] 表单中已有交易日期: ...</code></li>
                        <li><code>[DEBUG] handleTradeFormSubmit 接收到的 formData: ...</code></li>
                    </ul>
                </div>
                
                <h5 class="mt-4">常见问题</h5>
                <div class="alert alert-info">
                    <h6>如果交易日期仍然不能保存，请检查：</h6>
                    <ul class="mb-0">
                        <li>浏览器控制台是否有JavaScript错误</li>
                        <li>网络请求是否成功发送</li>
                        <li>服务器日志中是否有错误信息</li>
                        <li>数据库中的记录是否实际更新</li>
                    </ul>
                </div>
                
                <button class="btn btn-primary" onclick="testFormSerialization()">测试表单序列化</button>
                <button class="btn btn-secondary" onclick="testDateHandling()">测试日期处理</button>
            </div>
        </div>
    </div>

    <script>
        function testFormSerialization() {
            console.log('=== 测试表单序列化 ===');
            
            // 创建测试表单
            const form = document.createElement('form');
            form.innerHTML = `
                <input name="stock_code" value="000001">
                <input name="stock_name" value="平安银行">
                <input name="trade_type" value="buy">
                <input name="trade_date" type="datetime-local" value="2025-01-20T14:30">
                <input name="price" value="12.50">
                <input name="quantity" value="1000">
                <input name="reason" value="测试原因">
            `;
            
            // 测试FormData
            const formData = new FormData(form);
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            console.log('FormData结果:', data);
            console.log('交易日期值:', data.trade_date);
            console.log('交易日期类型:', typeof data.trade_date);
        }
        
        function testDateHandling() {
            console.log('=== 测试日期处理 ===');
            
            const testDates = [
                '2025-01-20T14:30',
                '2025-01-20T14:30:00',
                '2025-01-20T14:30:00.000Z',
                '2025-01-20 14:30:00'
            ];
            
            testDates.forEach(dateStr => {
                try {
                    const date = new Date(dateStr);
                    console.log(`${dateStr} -> ${date.toISOString()}`);
                } catch (e) {
                    console.error(`${dateStr} -> 解析失败:`, e.message);
                }
            });
        }
    </script>
</body>
</html>