<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIè°ƒç”¨é—®é¢˜è°ƒè¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">ğŸ” APIè°ƒç”¨é—®é¢˜è°ƒè¯•</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-warning">
                            <h6>ğŸ¤” å½“å‰é—®é¢˜åˆ†æï¼š</h6>
                            <ul class="mb-0">
                                <li>è¡¨å•éªŒè¯é€šè¿‡ âœ…</li>
                                <li>è¡¨å•æ•°æ®è·å–æˆåŠŸ âœ…</li>
                                <li>ä½†æ˜¯APIè¯·æ±‚æ²¡æœ‰å‘é€åˆ°åç«¯ âŒ</li>
                                <li>å¯èƒ½åœ¨ <code>createTradeWithProfitTargets</code> æˆ– <code>apiClient.createTrade</code> ä¸­å‡ºç°é—®é¢˜</li>
                            </ul>
                        </div>

                        <div class="alert alert-info">
                            <h6>ğŸ“‹ è°ƒè¯•æ­¥éª¤ï¼š</h6>
                            <ol>
                                <li>æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—åˆ°å…³é”®æ–¹æ³•</li>
                                <li>æ£€æŸ¥ <code>createTradeWithProfitTargets</code> æ–¹æ³•æ‰§è¡Œ</li>
                                <li>æ£€æŸ¥ <code>apiClient.createTrade</code> è°ƒç”¨</li>
                                <li>æ£€æŸ¥å¼‚å¸¸å¤„ç†å’Œé”™è¯¯æ•è·</li>
                            </ol>
                        </div>

                        <div class="alert alert-success">
                            <h6>ğŸ”§ å·²æ·»åŠ çš„è°ƒè¯•æ—¥å¿—ï¼š</h6>
                            <ul>
                                <li><code>ğŸ¯ æŒ‰é’®ç‚¹å‡»äº‹ä»¶å¼€å§‹å¤„ç†...</code></li>
                                <li><code>ğŸ¯ å‡†å¤‡è°ƒç”¨ tradingManager.saveTrade()...</code></li>
                                <li><code>ğŸš€ å‡†å¤‡å‘é€APIè¯·æ±‚...</code></li>
                                <li><code>ğŸ”§ createTradeWithProfitTargets è¢«è°ƒç”¨</code></li>
                                <li><code>ğŸ“¡ è°ƒç”¨ apiClient.createTrade...</code></li>
                                <li><code>ğŸ“¨ apiClient.createTrade å“åº”:</code></li>
                                <li><code>ğŸ“¥ APIå“åº”:</code></li>
                            </ul>
                        </div>

                        <h6>ğŸ§ª æµ‹è¯•æ­¥éª¤ï¼š</h6>
                        <ol>
                            <li>æ‰“å¼€äº¤æ˜“è®°å½•é¡µé¢</li>
                            <li>ç‚¹å‡»"æ·»åŠ äº¤æ˜“"æŒ‰é’®</li>
                            <li>é€‰æ‹©"å–å‡º"ç±»å‹</li>
                            <li>å¡«å†™è¡¨å•æ•°æ®</li>
                            <li>ç‚¹å‡»"ä¿å­˜"æŒ‰é’®</li>
                            <li>è§‚å¯Ÿæµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†æ—¥å¿—</li>
                            <li>æ£€æŸ¥ç½‘ç»œé¢æ¿æ˜¯å¦æœ‰APIè¯·æ±‚</li>
                        </ol>

                        <div class="alert alert-danger">
                            <h6>ğŸš¨ å¯èƒ½çš„é—®é¢˜ç‚¹ï¼š</h6>
                            <ul class="mb-0">
                                <li><strong>å¼‚æ­¥è°ƒç”¨é—®é¢˜</strong> - await è°ƒç”¨å¯èƒ½è¢«ä¸­æ–­</li>
                                <li><strong>this ä¸Šä¸‹æ–‡é—®é¢˜</strong> - æ–¹æ³•è°ƒç”¨æ—¶ä¸Šä¸‹æ–‡ä¸¢å¤±</li>
                                <li><strong>APIå®¢æˆ·ç«¯é—®é¢˜</strong> - apiClient.createTrade æ–¹æ³•å¼‚å¸¸</li>
                                <li><strong>ç½‘ç»œè¯·æ±‚é—®é¢˜</strong> - axios è¯·æ±‚è¢«é˜»æ­¢æˆ–å¤±è´¥</li>
                                <li><strong>è¡¨å•æ•°æ®é—®é¢˜</strong> - æ•°æ®æ ¼å¼ä¸ç¬¦åˆåç«¯è¦æ±‚</li>
                            </ul>
                        </div>

                        <div class="mt-4">
                            <button type="button" class="btn btn-primary" onclick="testDirectAPI()">
                                ğŸ§ª ç›´æ¥æµ‹è¯•APIè°ƒç”¨
                            </button>
                            <button type="button" class="btn btn-success" onclick="window.location.href='/trading-records'">
                                ğŸš€ å‰å¾€äº¤æ˜“è®°å½•é¡µé¢è°ƒè¯•
                            </button>
                        </div>

                        <div id="test-result" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
    
    <script>
        async function testDirectAPI() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = '<div class="alert alert-info">ğŸ”„ æµ‹è¯•ç›´æ¥APIè°ƒç”¨...</div>';
            
            // æ¨¡æ‹Ÿå–å‡ºäº¤æ˜“æ•°æ®
            const testData = {
                stock_code: '002460',
                stock_name: 'èµ£é”‹é”‚ä¸š',
                trade_type: 'sell',
                trade_date: new Date().toISOString(),
                price: 38.16,
                quantity: 7600,
                reason: 'éƒ¨åˆ†æ­¢ç›ˆ',
                notes: 'æµ‹è¯•å–å‡ºè®°å½•'
            };
            
            try {
                console.log('ğŸ§ª ç›´æ¥æµ‹è¯•APIè°ƒç”¨');
                console.log('ğŸ“¤ æµ‹è¯•æ•°æ®:', testData);
                
                const response = await axios.post('/api/trades', testData, {
                    headers: { 'Content-Type': 'application/json' },
                    timeout: 10000
                });
                
                console.log('ğŸ“¨ APIå“åº”:', response);
                
                if (response.data && response.data.success) {
                    resultDiv.innerHTML = `
                        <div class="alert alert-success">
                            <h6>âœ… ç›´æ¥APIè°ƒç”¨æˆåŠŸ</h6>
                            <p class="mb-0">åç«¯APIå·¥ä½œæ­£å¸¸ï¼Œé—®é¢˜å¯èƒ½åœ¨å‰ç«¯çš„è°ƒç”¨é“¾ä¸­ã€‚</p>
                            <small class="text-muted">å“åº”: ${JSON.stringify(response.data, null, 2)}</small>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-warning">
                            <h6>âš ï¸ APIå“åº”å¼‚å¸¸</h6>
                            <p class="mb-0">APIæœ‰å“åº”ä½†æ ¼å¼ä¸ç¬¦åˆé¢„æœŸ</p>
                            <small class="text-muted">å“åº”: ${JSON.stringify(response.data, null, 2)}</small>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('ğŸ’¥ ç›´æ¥APIè°ƒç”¨å¤±è´¥:', error);
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>âŒ ç›´æ¥APIè°ƒç”¨å¤±è´¥</h6>
                        <p class="mb-0">é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                        <small class="text-muted">è¿™è¯´æ˜é—®é¢˜å¯èƒ½åœ¨ç½‘ç»œå±‚æˆ–åç«¯</small>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>